import{r as x,j as e}from"./radix-B0d9A4Hp.js";import{aa as J,z as O,cI as s,cJ as L,cK as E,cL as C,cM as V,cN as Y,E as T,bt as X,bu as ee,bv as se,aN as B,m as q,U as te,ac as W,q as Z,P as ae,aq as re,W as ie,az as oe,an as ne,bE as le,cO as ce,cP as de}from"./index-DqfNU3ry.js";import{G as ue}from"./gamepad-2-iVp1Sf0h.js";import"./tanstack-BKPRn8Ud.js";import"./animation-tNjqXOyv.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],me=J("leaf",ge);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],fe=J("user-round",pe);function he(a,n){const p=(a-n)/(1024*1024),r=p*.5,l=p*.2*10,d=r+l,u=d/60,k=d/8.8,f=ve(p,d),$=be();return{co2Saved:Math.round(d*10)/10,treeDays:Math.round(u*10)/10,smartphoneCharges:Math.round(k),message:f,funFact:$}}function ve(a,n){const w=[`ğŸŒ± Nice! You've saved ${n.toFixed(1)}g of CO2 - that's like planting a tiny digital tree!`,`ğŸŒ Your compression saved ${a.toFixed(1)}MB - Mother Earth says thank you!`,`â™»ï¸ Eco-warrior mode: ${n.toFixed(1)}g CO2 saved! Every byte counts!`,`ğŸŒ¿ You just gave the planet a little hug by saving ${a.toFixed(1)}MB!`,`ğŸŒ³ Your compressed image saves as much CO2 as a tree absorbs in ${(n/60).toFixed(1)} days!`,`âš¡ Compression complete! You saved enough energy to charge a phone ${Math.round(n/8.8)} times!`,`ğŸ¦‹ Small action, big impact: ${n.toFixed(1)}g CO2 saved for future generations!`,`ğŸŒŠ Every drop counts! Your ${a.toFixed(1)}MB savings helps reduce data center cooling needs!`,`â˜ï¸ Less cloud storage = clearer skies! ${n.toFixed(1)}g CO2 saved!`,`ğŸš´ Your compression is equivalent to biking instead of driving for ${(n/20).toFixed(1)} minutes!`];return w[Math.floor(Math.random()*w.length)]}function be(){const a=["ğŸ’¡ Did you know? If everyone compressed their images, we could power a city for a year!","ğŸŒ Fun fact: The internet uses about 10% of global electricity - every compressed image helps!","ğŸ“± A single email generates 4g of CO2 - your compressed image just offset several emails!","ğŸ¢ Data centers use 200 TWh per year - that's more than Argentina's entire country!","ğŸŒ¡ï¸ Compressed images = cooler planet! Data centers need massive cooling systems.","ğŸ® Gaming for 1 hour uses less energy than storing 1GB of data for a year!","ğŸŒ² One tree absorbs 22kg of CO2 per year - every bit of compression adds up!","ğŸ’¾ The world stores 64 zettabytes of data - imagine if it was all compressed!","ğŸš— Streaming 1 hour of video = driving 1 mile. Compression reduces this impact!","ğŸ Even bees would approve - less server heat means healthier ecosystems!","â˜• Your compression saved enough energy to brew a cup of coffee!","ğŸŒ» If the internet was a country, it would rank 6th in electricity usage!","ğŸ¯ Pro tip: WebP format can reduce file sizes by 25-35% compared to JPEG!","ğŸ¦œ Nature fact: Digital storage has a real carbon footprint - you're helping reduce it!","ğŸŒˆ Every 1MB saved prevents 20g of CO2 over its lifetime in the cloud!","ğŸ¨ Artists rejoice: Compressed images load faster AND save the planet!","ğŸ”‹ Your image compression could power an LED bulb for 30 minutes!","ğŸŒº Hawaii could be powered for 2 hours with the energy saved if everyone compressed photos!","ğŸ“Š Studies show 90% of uploaded images are never viewed again - but still use energy!","ğŸƒ Green computing: Your small action joins millions making a real difference!"];return a[Math.floor(Math.random()*a.length)]}function xe(a,n,w=1){const p=he(a,n),r=w>1?`ğŸŒ ${w} images compressed sustainably!`:"ğŸŒ Image compressed sustainably!",d=[`Saved ${((a-n)/(1024*1024)).toFixed(1)}MB and ${p.co2Saved}g CO2! ${p.funFact}`,`${p.message}
${p.funFact}`,`You saved energy for ${p.smartphoneCharges} phone charges! ${p.funFact}`,`That's like a tree working for ${p.treeDays} days! ${p.funFact}`];return{title:r,description:d[Math.floor(Math.random()*d.length)]}}function we(){const a=["ğŸŒ± Optimizing for the planet...","â™»ï¸ Reducing digital carbon footprint...","ğŸŒ Making the internet a bit greener...","ğŸŒ¿ Compressing with love for Earth...","âš¡ Saving energy, one pixel at a time...","ğŸŒ³ Digital trees are being planted...","â˜ï¸ Lightening the cloud's load...","ğŸ¦‹ Creating a butterfly effect of savings...","ğŸŒŠ Making waves in sustainable tech...","ğŸŒ» Growing a greener internet..."];return a[Math.floor(Math.random()*a.length)]}function $e({currentAvatar:a,onAvatarChange:n,disabled:w=!1}){const p=O(o=>o.preferences),[r,l]=x.useState({stage:"idle",progress:0,message:""}),[d,u]=x.useState(""),[k,f]=x.useState(!1),$=x.useCallback(()=>{setTimeout(()=>{l({stage:"idle",progress:0,message:""})},3e3)},[]),U=x.useCallback(async o=>{let t=null;const v=p?.avatar||"",g=v||a||"",b=g&&(g.includes("appwrite")||g.includes("api.blueprint-create.com"));if(s(`ğŸ” DEBUG: Starting upload with currentAvatar prop: "${a}"`,0,"debug"),s(`ğŸ” DEBUG: Store avatar URL: "${v}"`,0,"debug"),s(`ğŸ” DEBUG: Final avatarUrlToCheck: "${g}"`,0,"debug"),s(`ğŸ” DEBUG: avatarUrlToCheck includes 'appwrite': ${g?.includes("appwrite")}`,0,"debug"),s(`ğŸ” DEBUG: avatarUrlToCheck includes 'api.blueprint-create.com': ${g?.includes("api.blueprint-create.com")}`,0,"debug"),s(`ğŸ” DEBUG: isAppwriteUrl: ${b}`,0,"debug"),b){s(`ğŸ“¸ Current avatar URL detected: ${g}`,0,"action");const i=[/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/,/\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/];for(let c=0;c<i.length;c++){const S=i[c],F=S.exec(g);if(s(`Pattern ${c+1}: ${S.source} - Match: ${F?F[1]:"no match"}`,0,"debug"),F&&F[1]){t=F[1],s(`âœ“ Extracted old avatar ID: ${t} using pattern ${c+1}`,0,"action");break}}if(!t){s(`âŒ Could not extract file ID from URL: ${g}`,3,"action");const c=g.match(/files\/([a-zA-Z0-9]+)/);c&&c[1]&&(t=c[1],s(`âœ“ Extracted using simple pattern: ${t}`,0,"action"))}}try{l({stage:"uploading",progress:20,message:"Uploading image..."});const i=L.unique(),c=await E.createFile(C.AVATARS,i,o);s(`Original image uploaded: ${c.$id}`,0,"action"),l({stage:"compressing",progress:50,message:we()});const F=await new V(Y).createExecution("image-compressor",JSON.stringify({bucketId:C.AVATARS,fileId:c.$id,quality:90,width:500,height:500,preserveOriginal:!1}));let D=0,M=F;for(;M.status==="waiting"||M.status==="processing";){if(D>30)throw new Error("Image compression timeout");await new Promise(A=>setTimeout(A,1e3)),M=await new V(Y).getExecution("image-compressor",M.$id),D++,l(A=>({...A,progress:Math.min(50+D*1.5,80),message:`Processing image... (${D}s)`}))}if(M.status!=="completed")throw new Error(`Compression failed: ${M.responseBody||"Unknown error"}`);const m=JSON.parse(M.responseBody);if(!m.success&&!m.uploadFailed)throw new Error(m.error||"Compression failed");let z=m.compressed.id,_=!1;if(m.uploadFailed&&m.compressed.base64){s("Compression succeeded but upload failed, uploading from client...",1,"action");const A=await(await fetch(`data:image/webp;base64,${m.compressed.base64}`)).blob(),N=new File([A],m.compressed.name,{type:"image/webp"});z=(await E.createFile(C.AVATARS,L.unique(),N)).$id,s(`Client-side upload completed: ${z}`,0,"action");try{await E.deleteFile(C.AVATARS,c.$id),s(`Deleted original uncompressed file: ${c.$id}`,0,"action"),_=!0}catch(R){s(`Failed to delete original file: ${R}`,2,"action")}}else s(`Image compressed: ${z}`,0,"action"),_=m.original.deleted;_||s(`Warning: Original file ${c.$id} may still exist`,1,"action"),l({stage:"saving",progress:90,message:"Saving compressed image...",details:{originalSize:m.original.size,compressedSize:m.compressed.size,compressionRatio:m.stats.compressionRatio}});const Q=E.getFilePreview(C.AVATARS,z).toString();l({stage:"complete",progress:100,message:`Image compressed successfully! Saved ${m.stats.compressionRatio} space`,details:{originalSize:m.original.size,compressedSize:m.compressed.size,compressionRatio:m.stats.compressionRatio}});const G=xe(m.original.size||o.size,m.compressed.size||0);if(T.success(G.title,{description:G.description,duration:8e3,icon:e.jsx(me,{className:"text-green-500"})}),n(Q),s(`ğŸ” DEBUG: About to check for old avatar deletion. oldAvatarId: "${t}"`,0,"debug"),s(`ğŸ” DEBUG: compressedFileId: "${z}"`,0,"debug"),t)if(t===z)s(`Skipping deletion - old and new IDs are the same: ${t}`,1,"action");else{s(`ğŸ—‘ï¸ Attempting to delete old avatar: ${t} from bucket: ${C.AVATARS}`,0,"action");try{const y=await E.getFile(C.AVATARS,t);s(`âœ“ Old avatar file exists: ${y.name} (${y.sizeOriginal} bytes)`,0,"action")}catch(y){const A=y instanceof Error?y.message:String(y);if(s(`â„¹ï¸ Old avatar file doesn't exist or can't be accessed: ${A}`,1,"action"),A.includes("404")||A.includes("not found")){s(`Old avatar ${t} was already deleted`,1,"action");return}}try{s(`ğŸ”¥ Executing deletion: storage.deleteFile("${C.AVATARS}", "${t}")`,0,"debug");const y=await E.deleteFile(C.AVATARS,t);s(`âœ… Successfully deleted old avatar: ${t}`,0,"action"),s(`Delete result: ${JSON.stringify(y)}`,0,"debug"),T.success("Previous avatar removed successfully",{duration:3e3})}catch(y){const A=y,N=A?.message||String(y)||"Unknown error",I=A?.code||"unknown",R=A?.type||"unknown";s(`âŒ Failed to delete old avatar ${t}: ${N} (code: ${I}, type: ${R})`,3,"action"),N.includes("404")||N.includes("not found")||I===404?(s(`â„¹ï¸ Old avatar ${t} was already deleted or doesn't exist`,1,"action"),T.info("Previous avatar was already removed",{duration:2e3})):(console.error("Avatar deletion error details:",{error:y,message:N,code:I,type:R,fileId:t,bucketId:C.AVATARS}),T.error(`Could not remove previous avatar: ${N}`,{duration:5e3}))}}else s("âš ï¸ No old avatar ID found to delete",1,"action"),s(`ğŸ” DEBUG: Why no deletion? avatarUrlToCheck: "${g}"`,0,"debug"),s(`ğŸ” DEBUG: isAppwriteUrl: ${b}`,0,"debug");$()}catch(i){s(`Avatar upload error: ${i}`,3,"action"),l({stage:"error",progress:0,message:i instanceof Error?i.message:"Failed to upload image"}),$()}},[a,p,n,$]),h=x.useCallback(async o=>{const t=o.target.files?.[0];if(t){if(t.size>10*1024*1024){l({stage:"error",progress:0,message:"File size must be less than 10MB"}),$();return}if(!t.type.startsWith("image/")){l({stage:"error",progress:0,message:"Please select a valid image file"}),$();return}await U(t)}},[U,$]),j=x.useCallback(async()=>{if(d.trim())try{f(!0);const o=`https://minotar.net/helm/${d}/500`,t=new Image;t.onload=async()=>{if(s(`Minecraft avatar set: ${o}`,0,"action"),n(o),a&&(a.includes("appwrite")||a.includes("api.blueprint-create.com"))){s(`Deleting old avatar before Minecraft skin: ${a}`,0,"action");const g=[/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/,/\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/];let b=null;for(const i of g){const c=i.exec(a);if(c&&c[1]){b=c[1];break}}if(!b){const i=a.match(/files\/([a-zA-Z0-9]+)/);i&&i[1]&&(b=i[1],s(`Extracted using simple pattern: ${b}`,0,"action"))}if(b)try{await E.deleteFile(C.AVATARS,b),s(`âœ“ Deleted old avatar after setting Minecraft skin: ${b}`,0,"action")}catch(i){const S=i?.message||String(i)||"Unknown error";S.includes("404")||S.includes("not found")?s(`Old avatar ${b} was already deleted or doesn't exist`,1,"action"):s(`Failed to delete old avatar: ${S}`,2,"action")}else s(`âŒ Could not extract file ID from avatar URL: ${a}`,1,"action")}u(""),f(!1),l({stage:"complete",progress:100,message:"Minecraft avatar set successfully!"}),$()},t.onerror=v=>{l({stage:"error",progress:0,message:"Minecraft username not found"}),f(!1),$()},t.src=o}catch{l({stage:"error",progress:0,message:"Failed to fetch Minecraft avatar"}),f(!1),$()}},[d,a,n,$]),P=x.useCallback(async o=>{s(`ğŸ§ª Testing avatar deletion for file ID: ${o}`,0,"debug");try{const t=await E.getFile(C.AVATARS,o);s(`âœ“ File exists: ${t.name} (${t.sizeOriginal} bytes)`,0,"debug");const v=await E.deleteFile(C.AVATARS,o);return s(`âœ… Test deletion successful: ${JSON.stringify(v)}`,0,"debug"),console.log("Test deletion result:",v),{success:!0,result:v}}catch(t){const v=t instanceof Error?t.message:String(t);return s(`âŒ Test deletion failed: ${v}`,3,"debug"),console.error("Test deletion error:",t),{success:!1,error:t}}},[]);x.useEffect(()=>(window.testAvatarDeletion=P,window.debugAvatarExtraction=o=>{const t=[/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/buckets\/[^/]+\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/,/\/files\/([a-zA-Z0-9]+)\/preview(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)\/view(?:\?|$)/,/\/files\/([a-zA-Z0-9]+)(?:\/|$|\?)/];for(let g=0;g<t.length;g++){const b=t[g],i=b.exec(o);if(console.log(`Pattern ${g+1}: ${b.source} - Match: ${i?i[1]:"no match"}`),i&&i[1])return console.log(`âœ“ Extracted file ID: ${i[1]}`),i[1]}const v=o.match(/files\/([a-zA-Z0-9]+)/);return v&&v[1]?(console.log(`âœ“ Simple pattern worked: ${v[1]}`),v[1]):(console.log("âŒ No patterns matched"),null)},()=>{delete window.testAvatarDeletion,delete window.debugAvatarExtraction}),[P]);const K=()=>{switch(r.stage){case"uploading":case"compressing":case"saving":return e.jsx(ne,{className:"h-4 w-4 animate-spin"});case"complete":return e.jsx(oe,{className:"h-4 w-4"});case"error":return e.jsx(ie,{className:"h-4 w-4"});default:return e.jsx(re,{className:"h-4 w-4"})}},H=()=>{switch(r.stage){case"complete":return"text-green-600 dark:text-green-400";case"error":return"text-red-600 dark:text-red-400";default:return"text-blue-600 dark:text-blue-400"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(X,{className:"h-20 w-20",children:[e.jsx(ee,{src:a}),e.jsx(se,{children:e.jsx(fe,{className:"h-10 w-10"})})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(B,{htmlFor:"picture",className:"cursor-pointer",children:[e.jsxs("div",{className:q("flex items-center gap-2 rounded-md px-4 py-2 text-sm transition-colors","bg-secondary hover:bg-secondary/80 text-secondary-foreground",w&&"opacity-50 cursor-not-allowed"),children:[e.jsx(te,{className:"h-4 w-4"}),"Upload Image"]}),e.jsx("input",{id:"picture",type:"file",className:"hidden",accept:"image/*",onChange:h,disabled:w||r.stage!=="idle"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{placeholder:"Minecraft username",value:d,onChange:o=>u(o.target.value),onKeyPress:o=>{o.key==="Enter"&&j()},disabled:w||k,className:"w-48"}),e.jsxs(Z,{type:"button",variant:"secondary",size:"sm",onClick:j,disabled:w||k||!d.trim(),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Use Minecraft"]})]})]})]}),r.stage!=="idle"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:q("flex items-center gap-2",H()),children:[K(),e.jsx("span",{className:"text-sm font-medium",children:r.message})]}),r.stage!=="complete"&&r.stage!=="error"&&e.jsx(ae,{value:r.progress,className:"h-2"}),r.details&&e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[r.details.originalSize&&e.jsxs("div",{children:["Original: ",(r.details.originalSize/1024).toFixed(1)," KB â†’ Compressed: ",(r.details.compressedSize/1024).toFixed(1)," KB"]}),r.details.compressionRatio&&e.jsxs("div",{children:["Space saved: ",r.details.compressionRatio]})]})]})]})}function je(){const[a,n]=x.useState(!1),[w,p]=x.useState(null),[r,l]=x.useState({username:"",bio:"",avatar:""}),d=O(h=>h.user),u=O(h=>h.preferences),k=O(h=>h.updatePreferences),{t:f}=le();x.useEffect(()=>{d&&l({username:d?.name||"",bio:u?.bio??"",avatar:u?.avatar??""})},[d,u]);const $=x.useCallback(async()=>{n(!0);try{s("Saving of the profile in progress",0,"action"),await ce.updateName(r.username),await k({theme:u?.theme??"light",language:u?.language??"en",notificationsEnabled:u?.notificationsEnabled||!1,roles:u?.roles||[],bio:r.bio,avatar:r.avatar}),s("Saving of the profile done",0,"action")}catch(h){throw s("Error while saving the profile ",3,"action"),p("Error while saving the profile"),h}finally{n(!1)}},[u,r,k]),U=x.useCallback(async h=>{l(j=>({...j,avatar:h})),await k({theme:u?.theme??"light",language:u?.language??"en",notificationsEnabled:u?.notificationsEnabled||!1,roles:u?.roles||[],bio:r.bio,avatar:h}),s("Avatar updated successfully",0,"action")},[r.bio,u,k]);return w?e.jsx("div",{className:"text-destructive",children:w}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:f("settings.user-settings.public-profile.title")}),e.jsx("p",{className:"text-foreground-muted text-sm",children:f("settings.user-settings.public-profile.description")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:f("settings.user-settings.public-profile.picture.title")}),e.jsx($e,{currentAvatar:r.avatar,onAvatarChange:U,disabled:a})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"username",children:f("settings.user-settings.public-profile.username.title")}),e.jsx("p",{className:"text-foreground-muted mb-2 text-sm",children:f("settings.user-settings.public-profile.username.description")}),e.jsx(W,{id:"username",value:r.username,onChange:h=>l(j=>({...j,username:h.target.value})),className:"max-w-md"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"bio",children:f("settings.user-settings.public-profile.bio.title")}),e.jsx("p",{className:"text-foreground-muted mb-2 text-sm",children:f("settings.user-settings.public-profile.bio.description")}),e.jsx(de,{id:"bio",value:r.bio,onChange:h=>l(j=>({...j,bio:h.target.value})),className:"min-h-[100px]"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Z,{onClick:$,disabled:a,children:f("settings.user-settings.public-profile.actions.save")}),e.jsx(Z,{variant:"secondary",asChild:!0,children:e.jsx("a",{href:"/profile",children:f("settings.user-settings.public-profile.actions.visit")})})]})]})]}):e.jsx("div",{children:"Loading..."})}export{je as default};
