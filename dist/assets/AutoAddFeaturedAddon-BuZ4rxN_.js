import{r as h,j as a}from"./radix-bXgmYFMM.js";import{f as O,d as R,C as U,a as B,bo as w,X as F,r as k,ah as E,ai as _,aj as D,ak as L,al as $,bk as I,c as M}from"./index-BNMRn6sK.js";import{u as P}from"./useSearchAddons-BfnTWvSC.js";import{b as V,d as H}from"./useFeaturedAddons-BpyRE2_1.js";import{S as Q}from"./switch-CSwYXRZm.js";import"./tanstack-57jHkLwp.js";import"./animation-CiItlcC_.js";function T(b){const e=M.c(22),{imageUrl:t,index:r,isSelected:d,onSelect:i}=b,[o,y]=h.useState(!0);let g;e[0]!==t?(g=t.replace(/_\d+\.webp$/,".webp"),e[0]=t,e[1]=g):g=e[1];const l=g;let c,x;e[2]!==r||e[3]!==l?(c=()=>{fetch(l,{method:"HEAD"}).then(j=>{j.ok?console.log(`[GalleryImageItem - ${r}] Full res exists for: ${l}`):(y(!1),console.log(`[GalleryImageItem - ${r}] Full res check failed for: ${l}`))}).catch(()=>{y(!1),console.log(`[GalleryImageItem - ${r}] Full res check error for: ${l}`)})},x=[l,r],e[2]=r,e[3]=l,e[4]=c,e[5]=x):(c=e[4],x=e[5]),h.useEffect(c,x);let u;e[6]!==t||e[7]!==r||e[8]!==o||e[9]!==i||e[10]!==l?(u=()=>{const j=o?l:t;console.log(`[GalleryImageItem - ${r}] Calling onSelect with: ${j}`),i(j)},e[6]=t,e[7]=r,e[8]=o,e[9]=i,e[10]=l,e[11]=u):u=e[11];const v=`relative aspect-video overflow-hidden rounded-lg border-2 transition-all ${d?"border-primary scale-105 shadow-md":"hover:border-primary/30 border-transparent"}`,S=o?l:t,A=`Modrinth gallery image ${r+1}`;let n;e[12]!==S||e[13]!==A?(n=a.jsx("img",{src:S,alt:A,className:"h-full w-full object-cover",loading:"lazy"}),e[12]=S,e[13]=A,e[14]=n):n=e[14];let m;e[15]!==o?(m=!o&&a.jsx("div",{className:"absolute right-0 bottom-0 left-0 bg-black/50 p-1 text-xs text-white",children:"Lower resolution image"}),e[15]=o,e[16]=m):m=e[16];let f;return e[17]!==u||e[18]!==v||e[19]!==n||e[20]!==m?(f=a.jsxs("button",{onClick:u,className:v,children:[n,m]}),e[17]=u,e[18]=v,e[19]=n,e[20]=m,e[21]=f):f=e[21],f}function ee(){const[b,e]=h.useState(""),[t,r]=h.useState(null),[d,i]=h.useState(""),[o,y]=h.useState(0),[g,l]=h.useState(!0),[c,x]=h.useState("gallery"),{data:u,isLoading:v}=P({query:b,page:1,limit:10}),{data:S}=V(),{mutate:A}=H(),n=S?.map(s=>s.display_order)||[],m=Array.from({length:21},(s,p)=>p).filter(s=>!n.includes(s)),f=s=>{console.log("Selected addon:",s),console.log("Modrinth raw:",s.modrinth_raw),console.log("Modrinth raw parsed:",s.modrinth_raw_parsed),console.log("Gallery data:",s.modrinth_raw_parsed?.gallery),r(s),i("")},j=s=>{i(s)},G=()=>{if(!t){I({title:"Error",description:"Please select an addon",variant:"destructive"});return}if(!d){I({title:"Error",description:"Please select a banner image",variant:"destructive"});return}const s={addon_id:t.$id,title:t.name,description:t.description,image_url:t.icon,banner_url:d,display_order:o,slug:t.slug,active:g,category:Array.isArray(t.categories)?t.categories:t.categories?[t.categories]:null};A(s,{onSuccess:()=>{I({title:"Success",description:"Featured addon created successfully"}),r(null),i(""),y(0)},onError:p=>{I({title:"Error",description:"Failed to create featured addon "+p.message,variant:"destructive"})}})};return a.jsxs(O,{className:"mx-auto w-full max-w-2xl",children:[a.jsx(R,{children:a.jsx(U,{children:"Auto Add Featured Addon"})}),a.jsxs(B,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(w,{children:"Search Addon"}),a.jsx(F,{placeholder:"Search addons...",value:b,onChange:s=>e(s.target.value)}),v?a.jsx("div",{children:"Loading..."}):a.jsx("div",{className:"grid max-h-60 grid-cols-1 gap-2 overflow-y-auto",children:u?.map(s=>a.jsx(k,{variant:t?.$id===s.$id?"default":"outline",className:"justify-start",onClick:()=>f(s),children:s.name},s.$id))})]}),t&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(w,{children:"Banner Image Source"}),a.jsxs(E,{value:c,onValueChange:s=>x(s),children:[a.jsx(_,{children:a.jsx(D,{placeholder:"Select image source"})}),a.jsxs(L,{children:[a.jsx($,{value:"gallery",children:"Choose from gallery"}),a.jsx($,{value:"url",children:"Use URL"})]})]}),c==="gallery"&&t&&a.jsx("div",{className:"grid grid-cols-3 gap-2",children:(()=>{const p=(typeof t.modrinth_raw_parsed=="string"?JSON.parse(t.modrinth_raw_parsed):t.modrinth_raw_parsed)?.gallery;return p&&p.length>0?p.map((C,N)=>a.jsx(T,{imageUrl:C,index:N,isSelected:d===C.replace(/_\d+\.webp$/,".webp")||d===C,onSelect:j},`mr-${N}`)):a.jsx("div",{className:"text-muted-foreground col-span-3 py-4 text-center",children:"No gallery images available for this addon"})})()}),c==="url"&&a.jsx(F,{placeholder:"Enter banner image URL",value:d,onChange:s=>i(s.target.value)})]}),t&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(w,{children:"Display Order"}),a.jsxs(E,{value:o.toString(),onValueChange:s=>y(parseInt(s)),children:[a.jsx(_,{children:a.jsx(D,{placeholder:"Select display order"})}),a.jsx(L,{children:m.map(s=>a.jsxs($,{value:s.toString(),children:["Position ",s]},s))})]}),a.jsxs("div",{className:"text-muted-foreground text-sm",children:["Used positions: ",n.join(", ")]})]}),t&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Q,{id:"active",checked:g,onCheckedChange:l}),a.jsx(w,{htmlFor:"active",children:"Active"})]}),t&&a.jsx(k,{className:"w-full",onClick:G,disabled:!d||!t,children:"Create Featured Addon"})]})]})}export{ee as default};
