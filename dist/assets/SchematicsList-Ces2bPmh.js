import{r as f,j as d}from"./radix-bXgmYFMM.js";import{c as ie,h as ne,i as ae,j as le,g as oe,k as re,S as ce,l as me,L as he,U as fe,I as de}from"./index-BNMRn6sK.js";import{L as ue}from"./ListPageLayout-DGGzMnxd.js";import"./tanstack-57jHkLwp.js";import"./animation-CiItlcC_.js";function Le(){const e=ie.c(59),u=ne(),[i,R]=f.useState(1);let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[0]=p):p=e[0];const[_,S]=f.useState(p),[s,te]=f.useState(""),{filters:t,facets:q,filterString:D,hasActiveFilters:U,updateFilter:l,applyPreset:Q,clearFilters:o}=ae();let x;e[1]!==s||e[2]!==l?(x=()=>{l("query",s)},e[1]=s,e[2]=l,e[3]=x):x=e[3];let y;e[4]!==s?(y=[s],e[4]=s,e[5]=y):y=e[5],f.useEffect(x,y);let r;e[6]!==t||e[7]!==s?(r={...t,query:s},e[6]=t,e[7]=s,e[8]=r):r=e[8];let F;e[9]!==i||e[10]!==r?(F={filters:r,page:i,limit:16,enableFacets:!0},e[9]=i,e[10]=r,e[11]=F):F=e[11];const{data:g,isLoading:T,isError:V}=le(F);let C;e[12]!==g?.hits?(C=g?.hits||[],e[12]=g?.hits,e[13]=C):C=e[13];const n=C,c=g?i*16<g.estimatedTotalHits:!1,b=T,G=T||b;let m;e[14]!==c||e[15]!==b||e[16]!==i?(m=()=>{c&&!b&&(console.log("Loading more schematics. Current page:",i),R(Se))},e[14]=c,e[15]=b,e[16]=i,e[17]=m):m=e[17];let L;e[18]!==c||e[19]!==G||e[20]!==m?(L={loading:G,hasMore:c,onLoadMore:m},e[18]=c,e[19]=G,e[20]=m,e[21]=L):L=e[21];const{sentinelRef:H,loadingMore:O}=oe(L);let j;e[22]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{S([]),R(1)},e[22]=j):j=e[22];let E;e[23]!==D||e[24]!==t.sort||e[25]!==s?(E=[D,s,t.sort],e[23]=D,e[24]=t.sort,e[25]=s,e[26]=E):E=e[26],f.useEffect(j,E);let $;e[27]!==n||e[28]!==i?($=()=>{n&&n.length>0&&(console.log(`New hits fetched: ${n.length} items`),S(i===1?n:a=>{const N=new Set(a.map(pe)),Z=n.filter(ee=>!N.has(ee.$id||ee.id));return Z.length>0?[...a,...Z]:a}))},e[27]=n,e[28]=i,e[29]=$):$=e[29];const z=n?.length;let I;e[30]!==i||e[31]!==z?(I=[z,i],e[30]=i,e[31]=z,e[32]=I):I=e[32],f.useEffect($,I);let P;e[33]!==o?(P=()=>{o(),R(1),S([])},e[33]=o,e[34]=P):P=e[34];const B=P;let k;e[35]!==u?(k=a=>{const N=a.$id||a.id;return d.jsx(ce,{schematic:a,onClick:()=>u(`../schematics/${N}/${a.slug}`)},N)},e[35]=u,e[36]=k):k=e[36];const J=k,Y=[t.categories.length,t.subcategories.length,t.materials.primary.length,t.complexity.levels.length,t.compatibility.requiredMods.length,t.dimensions.width.min||t.dimensions.width.max?1:0,t.dimensions.height.min||t.dimensions.height.max?1:0,t.dimensions.blockCount.min||t.dimensions.blockCount.max?1:0].reduce(ge,0);let v;e[37]!==Q||e[38]!==o||e[39]!==q||e[40]!==t||e[41]!==l?(v=d.jsx(me,{filters:t,facets:q,onFilterChange:l,onClearFilters:o,onApplyPreset:Q}),e[37]=Q,e[38]=o,e[39]=q,e[40]=t,e[41]=l,e[42]=v):v=e[42];const K=v;let w;e[43]===Symbol.for("react.memo_cache_sentinel")?(w=re({variant:"default"}),e[43]=w):w=e[43];let A;e[44]===Symbol.for("react.memo_cache_sentinel")?(A=d.jsxs(he,{className:w,to:"../schematics/upload",children:[d.jsx(fe,{className:"mr-2 h-4 w-4"})," Upload Schematic"]}),e[44]=A):A=e[44];const se=A,W=`Schematic Filters${Y>0?` (${Y})`:""}`,X=T&&i===1;let h;e[45]!==_||e[46]!==V||e[47]!==O||e[48]!==J||e[49]!==H||e[50]!==X?(h=d.jsx(de,{items:_,renderItem:J,isLoading:X,isError:V,emptyMessage:"No schematics found matching your filters.",errorMessage:"Oops! Failed to load schematics.",infiniteScrollEnabled:!0,loadingMore:O,sentinelRef:H,animationEnabled:!0,animationDelay:.1,animationDuration:.4,staggerItemCount:16,skeletonCount:16}),e[45]=_,e[46]=V,e[47]=O,e[48]=J,e[49]=H,e[50]=X,e[51]=h):h=e[51];let M;return e[52]!==K||e[53]!==B||e[54]!==U||e[55]!==s||e[56]!==W||e[57]!==h?(M=d.jsx(ue,{searchValue:s,onSearchChange:te,searchPlaceholder:"Search schematics...",filters:K,onResetFilters:B,filterTitle:W,hasActiveFilters:U,headerContent:se,children:h}),e[52]=K,e[53]=B,e[54]=U,e[55]=s,e[56]=W,e[57]=h,e[58]=M):M=e[58],M}function ge(e,u){return e+u}function pe(e){return e.$id||e.id}function Se(e){return e+1}export{Le as default};
