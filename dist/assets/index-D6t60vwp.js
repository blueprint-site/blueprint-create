import{r as c,j as e}from"./radix-bXgmYFMM.js";import{m as ke,c as Ve,r as j,p as v,a8 as $e,X as Me,a5 as Ie,aL as me,aM as he,aN as xe,_ as ye,Q as oe,bk as M,T as Je,N as be,O as we,f as q,a as le,L as te,aE as Le,c6 as qe,ae as Se,d as Ge,C as Xe,b as Ze,aY as as,ap as ts,aq as is,ar as rs,as as ns,n as Ne,z as Be,aT as ds,bw as ls}from"./index-BNMRn6sK.js";import{D as ue}from"./data-table-DEENaoze.js";import{a as cs,b as Re,c as Fe,d as We}from"./useAddons-CiWxs4MW.js";import{S as ge}from"./switch-CSwYXRZm.js";import{c as De,T as _e,a as G,b as fe}from"./tabs--wTOZN4b.js";import{C as Ee}from"./circle-x-DtKEAWDu.js";import{m as O,A as ie}from"./animation-CiItlcC_.js";import{L as pe,C as os}from"./loader-circle-CdlSH8zB.js";import{A as He,a as Ke}from"./arrow-right-Mn3sVGwV.js";import{S as Ae}from"./separator-C4ByKgra.js";import{E as Ce}from"./external-link-gY0WA3so.js";import{a as Te,E as Ue}from"./eye-C4dNge0U.js";import{C as ze}from"./circle-check-C97TiTY2.js";import{u as ms}from"./useSearchAddons-BfnTWvSC.js";import{G as hs}from"./globe-KnvhcmSh.js";import{u as xs,a as us}from"./useFeaturedAddons-BpyRE2_1.js";import{P as gs}from"./plus-BuTLKKOH.js";import"./tanstack-57jHkLwp.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],je=ke("keyboard",fs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],js=ke("maximize-2",ps);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Ns=ke("minimize-2",vs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Pe=ke("triangle-alert",ys);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Oe=ke("undo-2",bs),ws=(d,k={})=>{const{enabled:t=!0,preventDefault:D=!0,ignoreInputs:o=!0}=k,_=c.useRef(d);return _.current=d,c.useEffect(()=>{if(!t)return;const h=b=>{if(o&&(b.target instanceof HTMLInputElement||b.target instanceof HTMLTextAreaElement||b.target instanceof HTMLSelectElement||b.target?.contentEditable==="true"))return;const u=_.current.find(w=>{const f=w.key.toLowerCase()===b.key.toLowerCase(),y=!!w.ctrl===(b.ctrlKey||b.metaKey),p=!!w.alt===b.altKey,E=!!w.shift===b.shiftKey;return f&&y&&p&&E});u&&(D&&b.preventDefault(),u.callback(b))};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t,D,o]),{shortcuts:_.current}},Ye=(d,k)=>{const t=Ve.c(33),D=k===void 0?!0:k;let o;t[0]!==d.onApprove?(o={key:"a",callback:d.onApprove,description:"Approve current addon"},t[0]=d.onApprove,t[1]=o):o=t[1];let _,h;t[2]!==d.onReject?(_={key:"r",callback:d.onReject,description:"Reject current addon"},h={key:"d",callback:d.onReject,description:"Reject current addon (alternative)"},t[2]=d.onReject,t[3]=_,t[4]=h):(_=t[3],h=t[4]);let b;t[5]!==d.onEnable?(b={key:"e",callback:d.onEnable,description:"Enable current addon"},t[5]=d.onEnable,t[6]=b):b=t[6];let u;t[7]!==d.onDisable?(u={key:"x",callback:d.onDisable,description:"Disable current addon"},t[7]=d.onDisable,t[8]=u):u=t[8];let w,f;t[9]!==d.onNext?(w={key:"ArrowDown",callback:d.onNext,description:"Move to next addon"},f={key:"j",callback:d.onNext,description:"Move to next addon (vim-style)"},t[9]=d.onNext,t[10]=w,t[11]=f):(w=t[10],f=t[11]);let y,p;t[12]!==d.onPrevious?(y={key:"ArrowUp",callback:d.onPrevious,description:"Move to previous addon"},p={key:"k",callback:d.onPrevious,description:"Move to previous addon (vim-style)"},t[12]=d.onPrevious,t[13]=y,t[14]=p):(y=t[13],p=t[14]);let E;t[15]!==d.onUndo?(E={key:"z",ctrl:!0,callback:d.onUndo,description:"Undo last action"},t[15]=d.onUndo,t[16]=E):E=t[16];let T;t[17]!==d.onExit?(T={key:"Escape",callback:d.onExit,description:"Exit review mode"},t[17]=d.onExit,t[18]=T):T=t[18];let z;t[19]!==o||t[20]!==E||t[21]!==T||t[22]!==_||t[23]!==h||t[24]!==b||t[25]!==u||t[26]!==w||t[27]!==f||t[28]!==y||t[29]!==p?(z=[o,_,h,b,u,w,f,y,p,E,T],t[19]=o,t[20]=E,t[21]=T,t[22]=_,t[23]=h,t[24]=b,t[25]=u,t[26]=w,t[27]=f,t[28]=y,t[29]=p,t[30]=z):z=t[30];const R=z;let C;return t[31]!==D?(C={enabled:D},t[31]=D,t[32]=C):C=t[32],ws(R,C)},ks=()=>{const d=Ve.c(1);let k;return d[0]===Symbol.for("react.memo_cache_sentinel")?(k=e.jsx("div",{children:"AddAddon works!"}),d[0]=k):k=d[0],k},As=()=>{const t="60vh",[D,o]=c.useState(15),[_,h]=c.useState(""),[b,u]=c.useState("all"),{data:w,isLoading:f,isError:y,error:p,refetch:E}=cs(),{mutateAsync:T,isPending:z}=Re(),R=c.useRef(null),C=c.useRef(null),H=w||[],S=H.filter(l=>{const $=_===""||l.name.toLowerCase().includes(_.toLowerCase())||l.authors?.join(", ").toLowerCase().includes(_.toLowerCase())||l.description?.toLowerCase().includes(_.toLowerCase());return b==="unchecked"?$&&!l.isChecked:$}),K=S.slice(0,D),P=D<S.length;c.useEffect(()=>{o(15)},[_,b]);const Q=c.useCallback(()=>{P&&o(l=>Math.min(l+10,S.length))},[P,S.length]);c.useEffect(()=>{const l=new IntersectionObserver(V=>{V[0].isIntersecting&&P&&Q()},{root:R.current,threshold:.1,rootMargin:"100px"}),$=C.current;return $&&l.observe($),()=>{$&&l.unobserve($)}},[Q,P]);const ee=async(l,$)=>{try{await T({addonId:l.$id,data:{isChecked:$}}),M({title:`Addon ${$?"marked as reviewed":"marked for review"}`,description:`${l.name} has been ${$?"reviewed":"marked for review"}.`}),E()}catch(V){M({variant:"destructive",title:"Update failed",description:"There was an error updating the review status."}),console.error("Unexpected error:",V)}},J=async(l,$)=>{try{const V=$?{isValid:$,isChecked:!0}:{isValid:$};await T({addonId:l.$id,data:V});let B={title:`Addon ${$?"activated":"deactivated"} successfully`,description:`${l.name} has been ${$?"approved":"disabled"}.`};$&&!l.isChecked&&(B.description+=" It has also been marked as reviewed."),M(B),E()}catch(V){M({variant:"destructive",title:"Update failed",description:"There was an error updating the addon status."}),console.error("Unexpected error:",V)}},re=[{accessorKey:"icon",header:"Icon",cell:({row:l})=>e.jsx(O.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:e.jsxs(me,{className:"border-border h-12 w-12 border",children:[e.jsx(he,{src:l.original.icon||"",alt:l.original.name}),e.jsx(xe,{className:"bg-primary/10 text-xs",children:l.original.name.slice(0,2).toUpperCase()})]})})},{accessorKey:"name",header:"Name",cell:({row:l})=>e.jsx("div",{className:"font-medium",children:l.original.name})},{accessorKey:"author",header:"Author",cell:({row:l})=>e.jsx("div",{className:"text-muted-foreground text-sm",children:l.original.authors?.join(", ")||"Unknown"})},{accessorKey:"description",header:"Description",cell:({row:l})=>e.jsx("div",{className:"max-w-md truncate text-sm",children:l.original.description||"No description available"})},{accessorKey:"review",header:"Review Status",cell:({row:l})=>e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{id:`review-${l.original.$id}`,checked:l.original.isChecked,onCheckedChange:$=>ee(l.original,$===!0),disabled:z||l.original.isValid}),e.jsxs("label",{htmlFor:`review-${l.original.$id}`,className:`text-sm ${l.original.isValid?"text-muted-foreground cursor-not-allowed":"cursor-pointer"}`,children:[l.original.isChecked?"Reviewed":"Mark as reviewed",l.original.isValid&&!l.original.isChecked&&" (auto-marked when enabled)"]})]}),l.original.isChecked?e.jsx(v,{variant:"outline",className:"border-green-300 bg-green-100 text-green-800",children:"Reviewed"}):e.jsx(v,{variant:"outline",className:"border-yellow-300 bg-yellow-100 text-yellow-800",children:"Needs Review"})]})},{accessorKey:"isValid",header:"Status",cell:({row:l})=>e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{id:`status-${l.original.$id}`,checked:l.original.isValid,onCheckedChange:$=>J(l.original,$),disabled:z}),e.jsx("label",{htmlFor:`status-${l.original.$id}`,className:"cursor-pointer text-sm",children:l.original.isValid?"Enabled":"Disabled"})]}),l.original.isValid?e.jsx(v,{variant:"outline",className:"border-green-300 bg-green-100 text-green-800",children:"Approved"}):e.jsx(v,{variant:"outline",className:"border-red-300 bg-red-100 text-red-800",children:"Disabled"})]})},{accessorKey:"downloads",header:"Downloads",cell:({row:l})=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(oe,{size:14,className:"text-muted-foreground"}),e.jsx("span",{children:l.original.downloads||0})]})}];return f?e.jsx("div",{className:"flex min-h-[400px] w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"border-primary h-8 w-8 animate-spin rounded-full border-4 border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading addons..."})]})}):y?e.jsx("div",{className:"flex min-h-[400px] w-full items-center justify-center",children:e.jsxs("div",{className:"text-destructive flex flex-col items-center space-y-4",children:[e.jsx(Ee,{size:48}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading addons"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:p?.message||"Unknown error"})]}),e.jsx(O.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(j,{onClick:()=>E(),variant:"outline",children:"Retry"})})]})}):e.jsxs("div",{className:"space-y-4 px-4 md:px-8",children:[e.jsxs(O.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Addons Management"}),e.jsxs("p",{className:"text-muted-foreground",children:["Review and manage addon extensions",H.filter(l=>!l.isChecked).length>0&&e.jsxs("span",{className:"ml-1",children:["(",e.jsx("span",{className:"font-medium text-yellow-600",children:H.filter(l=>!l.isChecked).length})," ","need review)"]})]})]}),e.jsxs(De,{defaultValue:"all",className:"w-full",onValueChange:u,children:[e.jsxs("div",{className:"mb-4 flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs(_e,{children:[e.jsx(G,{value:"all",children:"All Addons"}),e.jsxs(G,{value:"unchecked",children:["Needs Review",!f&&H.filter(l=>!l.isChecked).length>0&&e.jsx(v,{variant:"secondary",className:"ml-1",children:H.filter(l=>!l.isChecked).length})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"text-muted-foreground absolute top-2.5 left-2 h-4 w-4"}),e.jsx(Me,{placeholder:"Search addons...",value:_,onChange:l=>h(l.target.value),className:"w-full max-w-xs pl-8"})]})]}),e.jsxs("div",{className:"bg-background/60 text-muted-foreground sticky top-0 z-10 flex items-center justify-between border-b py-2 text-sm backdrop-blur-sm",children:[e.jsxs("span",{children:["Displaying ",K.length," of ",S.length," addons"]}),S.length>15&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>o(S.length),disabled:D>=S.length,children:"Show all"})]}),e.jsx(ie,{mode:"wait",children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"relative",children:e.jsxs("div",{ref:R,className:"border-border overflow-y-auto rounded-md border",style:{height:t},children:[e.jsxs(fe,{value:"all",className:"mt-0",children:[e.jsx(ue,{columns:re,data:K}),P&&e.jsx("div",{ref:C,className:"flex items-center justify-center py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"text-muted-foreground h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading more..."})]})}),!P&&D===S.length&&S.length>15&&e.jsxs("div",{className:"text-muted-foreground flex items-center justify-center py-4 text-sm",children:["Showing all ",S.length," results"]})]}),e.jsxs(fe,{value:"unchecked",className:"mt-0",children:[e.jsx(ue,{columns:re,data:K}),P&&e.jsx("div",{ref:C,className:"flex items-center justify-center py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"text-muted-foreground h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading more..."})]})}),!P&&D===S.length&&S.length>15&&e.jsxs("div",{className:"text-muted-foreground flex items-center justify-center py-4 text-sm",children:["Showing all ",S.length," results"]})]})]})},b)})]})]}),S.length===0&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"flex h-40 items-center justify-center rounded-md border border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2 text-center",children:[e.jsx(Ie,{size:20,className:"text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"No addons found"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:b==="unchecked"?"All addons have been reviewed!":"Try adjusting your search criteria."})]})]})})]})},Cs=()=>{const[d,k]=c.useState(1),[t,D]=c.useState(""),[o,_]=c.useState("unsorted"),[h,b]=c.useState(!1),[u,w]=c.useState(0),[f,y]=c.useState([]),[p,E]=c.useState([]),[T,z]=c.useState(new Set),R=25,{data:C,isLoading:H,isError:S,error:K,refetch:P,isFetching:Q}=Fe({search:o==="history"||t.trim()!==""?"":void 0,reviewStatus:o==="history"?"all":o},d,R),{data:ee,isLoading:J,isFetching:re}=We(t.trim(),d,R),{mutateAsync:l,isPending:$}=Re(),V=c.useRef(null),F=o==="history"?{addons:p.map(i=>i.addon),total:p.length,totalPages:Math.ceil(p.length/R)}:t.trim()?ee||{addons:[],total:0,totalPages:1}:C||{addons:[],total:0,totalPages:1},N=o==="history"||t.trim()?F.addons:F.addons.filter(i=>!T.has(i.$id)),X=o==="history"?Math.ceil(p.length/R):F.totalPages,L=t.trim()?J:H,Y=t.trim()?re:Q;c.useEffect(()=>{k(1),w(0),o==="history"&&z(new Set)},[t,o]),c.useEffect(()=>{u>=N.length&&N.length>0&&w(0)},[d,N.length,u]);const U=c.useCallback(i=>{const g={...i,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()};y(a=>[g,...a].slice(0,10))},[]),ne=c.useCallback((i,g)=>{const a={id:`${Date.now()}-${Math.random()}`,addon:{...i},action:g,timestamp:Date.now()};E(r=>[a,...r].slice(0,10)),z(r=>new Set([...r,i.$id]))},[]),ce=c.useCallback(()=>{E([]),M({title:"History cleared",description:"Review history has been cleared."})},[]),de=c.useCallback(async()=>{if(f.length===0)return;const i=f[0];try{await l({addonId:i.addonId,data:{[i.field]:i.previousValue}}),y(g=>g.slice(1)),z(g=>{const a=new Set(g);return a.delete(i.addonId),a}),E(g=>g.filter(a=>a.addon.$id!==i.addonId)),M({title:"Action undone",description:`Reverted ${i.addonName} to previous state.`}),P()}catch{M({variant:"destructive",title:"Undo failed",description:"Could not undo the last action."})}},[f,l,P]),W=async(i,g,a=!1)=>{try{if(U({addonId:i.$id,addonName:i.name,field:"isChecked",previousValue:i.isChecked,newValue:g}),await l({addonId:i.$id,data:{isChecked:g}}),ne(i,g?"approved":"rejected"),M({title:`Addon ${g?"approved":"marked for review"}`,description:`${i.name} has been ${g?"approved":"marked for review"}.`}),h&&a){const s=N.filter(m=>m.$id!==i.$id);u>=s.length&&s.length>0&&w(s.length-1)}P()}catch{M({variant:"destructive",title:"Update failed",description:"There was an error updating the review status."})}},Z=async(i,g,a=!1)=>{try{U({addonId:i.$id,addonName:i.name,field:"isValid",previousValue:i.isValid,newValue:g});const r=g?{isValid:g,isChecked:!0}:{isValid:g};await l({addonId:i.$id,data:r}),ne(i,g?"enabled":"disabled");let m={title:`Addon ${g?"activated":"deactivated"} successfully`,description:`${i.name} has been ${g?"approved":"disabled"}.`};if(g&&!i.isChecked&&(m.description+=" It has also been marked as reviewed."),M(m),h&&a){const x=N.filter(n=>n.$id!==i.$id);u>=x.length&&x.length>0&&w(x.length-1)}P()}catch{M({variant:"destructive",title:"Update failed",description:"There was an error updating the addon status."})}};Ye({onApprove:()=>{const i=N[u];i&&!i.isChecked&&W(i,!0,!0)},onReject:()=>{const i=N[u];i&&!i.isChecked&&W(i,!0,!0)},onEnable:()=>{const i=N[u];i&&!i.isValid&&Z(i,!0,!0)},onDisable:()=>{const i=N[u];i&&i.isValid&&Z(i,!1,!0)},onNext:()=>{w(i=>Math.min(i+1,N.length-1))},onPrevious:()=>{w(i=>Math.max(i-1,0))},onUndo:de,onExit:()=>b(!1)},h&&N.length>0),c.useEffect(()=>{if(h&&V.current){const i=V.current.querySelector(`[data-addon-index="${u}"]`);i&&i.scrollIntoView({behavior:"smooth",block:"center"})}},[u,h]);const ae=[{accessorKey:"icon",header:"Icon",cell:({row:i})=>e.jsx(O.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:e.jsxs(me,{className:"h-12 w-12",children:[e.jsx(he,{src:i.original.icon||"",alt:`${i.original.name} icon`}),e.jsx(xe,{children:i.original.name.charAt(0).toUpperCase()})]})})},{accessorKey:"name",header:"Name",cell:({row:i})=>{let g=null;if(i.original.modrinth_raw)try{const a=typeof i.original.modrinth_raw=="string"?JSON.parse(i.original.modrinth_raw):i.original.modrinth_raw;a?.slug&&(g=`https://modrinth.com/mod/${a.slug}`)}catch(a){console.warn("Failed to parse modrinth_raw data:",a)}if(!g&&i.original.curseforge_raw)try{const a=typeof i.original.curseforge_raw=="string"?JSON.parse(i.original.curseforge_raw):i.original.curseforge_raw;a?.links?.websiteUrl&&(g=a.links.websiteUrl)}catch(a){console.warn("Failed to parse curseforge_raw data:",a)}return g?e.jsx(te,{to:g,target:"_blank",rel:"noopener noreferrer",children:e.jsx("div",{className:"font-medium transition-colors hover:text-blue-600 dark:hover:text-blue-400",children:i.original.name})}):e.jsx("div",{className:"font-medium",children:i.original.name})}},{accessorKey:"authors",header:"Authors",cell:({row:i})=>e.jsx("div",{className:"text-muted-foreground text-sm",children:i.original.authors.join(", ")||"Unknown"})},{accessorKey:"description",header:"Description",cell:({row:i})=>e.jsx("div",{className:"max-w-md truncate text-sm",children:i.original.description||"No description available"})},...o==="history"?[{accessorKey:"action",header:"Action Taken",cell:({row:i})=>{const g=p.find(r=>r.addon.$id===i.original.$id);if(!g)return null;const a={approved:"bg-green-100 text-green-800 border-green-300",rejected:"bg-yellow-100 text-yellow-800 border-yellow-300",enabled:"bg-blue-100 text-blue-800 border-blue-300",disabled:"bg-red-100 text-red-800 border-red-300"};return e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(v,{variant:"outline",className:a[g.action],children:g.action.charAt(0).toUpperCase()+g.action.slice(1)}),e.jsx("span",{className:"text-muted-foreground text-xs",children:new Date(g.timestamp).toLocaleString()})]})}}]:[{accessorKey:"review",header:"Review Status",cell:({row:i,table:g})=>{const a=g.getRowModel().rows.findIndex(s=>s.original.$id===i.original.$id),r=h&&u===a;return e.jsxs("div",{className:`flex flex-col space-y-2 rounded-md p-2 transition-colors ${r?"bg-blue-100 ring-2 ring-blue-500 dark:bg-blue-900/20":""}`,"data-addon-index":a,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{id:`review-${i.original.$id}`,checked:i.original.isChecked,onCheckedChange:s=>W(i.original,s===!0),disabled:$||i.original.isValid}),e.jsxs("label",{htmlFor:`review-${i.original.$id}`,className:`text-sm ${i.original.isValid?"text-muted-foreground cursor-not-allowed":"cursor-pointer"}`,children:[i.original.isChecked?"Reviewed":"Mark as reviewed",i.original.isValid&&!i.original.isChecked&&" (auto-marked when enabled)"]})]}),i.original.isChecked?e.jsx(v,{variant:"outline",className:"w-fit border-green-300 bg-green-100 text-green-800",children:"Reviewed"}):e.jsx(v,{variant:"outline",className:"w-fit border-yellow-300 bg-yellow-100 text-yellow-800",children:"Needs Review"})]})}},{accessorKey:"isValid",header:"Status",cell:({row:i})=>e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{id:`valid-${i.original.$id}`,checked:i.original.isValid,onCheckedChange:g=>Z(i.original,g),disabled:$}),e.jsx("label",{htmlFor:`valid-${i.original.$id}`,className:"text-sm",children:i.original.isValid?"Enabled":"Disabled"})]}),e.jsx(v,{variant:i.original.isValid?"default":"destructive",className:"w-fit",children:i.original.isValid?"Active":"Inactive"})]})}],{accessorKey:"downloads",header:"Downloads",cell:({row:i})=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(oe,{size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:i.original.downloads?.toLocaleString()||"0"})]})}];return S?e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(Ee,{size:24}),e.jsx("span",{className:"text-lg font-medium",children:"Failed to load addons"})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:K?.message||"Unknown error"}),e.jsx(j,{onClick:()=>P(),variant:"outline",children:"Retry"})]})}):e.jsxs("div",{className:"space-y-6 px-4 md:px-8",children:[e.jsxs(O.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Addons Management"}),e.jsxs("p",{className:"text-muted-foreground",children:["Review and manage addon extensions efficiently",C&&C.total>0&&e.jsxs("span",{className:"ml-1",children:["(Page ",d," of ",X,", ",C.total," total)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[f.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:de,disabled:$,className:"flex items-center space-x-1",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Undo (",f.length,")"]})]}),o==="history"&&p.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:ce,className:"flex items-center space-x-1",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"Clear History"})]}),e.jsxs(j,{variant:h?"default":"outline",size:"sm",onClick:()=>b(!h),className:"flex items-center space-x-1",children:[e.jsx(je,{size:16}),e.jsx("span",{children:h?"Exit Review Mode":"Review Mode"})]})]})]}),e.jsx(ie,{children:h&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 space-y-3",children:e.jsxs(be,{className:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(we,{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{children:e.jsx("strong",{children:"Review Mode Active"})}),e.jsxs("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs dark:bg-blue-900",children:[u+1," of ",N.length," addon",N.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"A"})," ","approve,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"R"})," ","reject,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"E"})," ","enable,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"X"})," ","disable,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"â†‘/â†“"})," ","navigate,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"Ctrl+Z"})," ","undo,"," ",e.jsx("kbd",{className:"rounded-sm bg-gray-200 p-1 text-xs dark:bg-gray-700",children:"Esc"})," ","exit"]}),N.length>0&&e.jsx("div",{className:"mt-2 text-xs",children:"ðŸ’¡ Actions automatically move to the next addon for faster review"})]})]})})})]}),e.jsxs(De,{defaultValue:"unsorted",className:"w-full",onValueChange:i=>_(i),children:[e.jsxs("div",{className:"mb-4 flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs(_e,{children:[e.jsxs(G,{value:"unsorted",children:["Unsorted",C&&e.jsx(v,{variant:"destructive",className:"ml-1",children:C.addons.filter(i=>!i.isValid&&!T.has(i.$id)).length})]}),e.jsx(G,{value:"all",children:"All Addons (Approved)"}),e.jsxs(G,{value:"unreviewed",children:["Needs Review",C&&e.jsx(v,{variant:"secondary",className:"ml-1",children:C.addons.filter(i=>!i.isChecked&&!T.has(i.$id)).length})]}),e.jsx(G,{value:"reviewed",children:"Reviewed"}),e.jsxs(G,{value:"history",children:["History",e.jsx(v,{variant:"outline",className:"ml-1",children:p.length})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Me,{placeholder:o==="history"?"Search history...":"Search all addons...",value:t,onChange:i=>D(i.target.value),className:"w-[300px] pl-10",disabled:o==="history"})]})]}),e.jsx(fe,{value:o,className:"mt-0",children:e.jsx(ie,{mode:"wait",children:e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(q,{children:e.jsx(le,{className:"p-0",children:e.jsx("div",{ref:V,className:"max-h-[70vh] overflow-auto",children:L||Y?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:t.trim()?"Searching addons...":"Loading addons..."})]})}):e.jsx(ue,{columns:ae,data:o==="history"?p.slice((d-1)*R,d*R).map(i=>i.addon):N})})})}),X>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(i=>Math.max(i-1,1)),disabled:d===1||Q,children:[e.jsx(He,{size:16}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,X)},(i,g)=>{let a;if(X<=5)a=g+1;else{const r=Math.max(1,d-2),s=Math.min(X,r+4);a=Math.max(1,s-4)+g}return e.jsx(j,{variant:d===a?"default":"outline",size:"sm",onClick:()=>k(a),disabled:Q,className:"w-10",children:a},a)})}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(i=>Math.min(i+1,X)),disabled:d===X||Q,children:["Next",e.jsx(Ke,{size:16})]})]}),e.jsxs("div",{className:"text-muted-foreground mt-4 flex items-center justify-between text-sm",children:[e.jsx("div",{children:Y&&o!=="history"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:t.trim()?"Searching...":"Loading..."})]}):e.jsxs("span",{children:["Showing ",N.length," of"," ",o==="history"?p.length:F.total," ","addons",o==="history"&&" (from recent actions)",t.trim()&&" (search results)"]})}),f.length>0&&e.jsxs("div",{children:["Last ",f.length," action",f.length!==1?"s":""," in history"]})]})]},`${d}-${o}-${t}`)})})]}),!L&&!Y&&N.length===0&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"flex h-40 items-center justify-center rounded-md border border-dashed",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2 text-center",children:[e.jsx(Ie,{size:20,className:"text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:o==="history"?"No review history yet":(t.trim(),"No addons found")}),e.jsx("p",{className:"text-muted-foreground text-xs",children:o==="history"?"Actions taken on addons will appear here.":t.trim()?"Try adjusting your search terms.":o==="unreviewed"?"All addons have been reviewed!":"Try adjusting your search criteria."})]})]})})]})},Ss=()=>{const[d,k]=c.useState(1),[t,D]=c.useState(""),[o,_]=c.useState("unsorted"),[h,b]=c.useState(!1),[u,w]=c.useState(0),[f,y]=c.useState([]),[p,E]=c.useState([]),[T,z]=c.useState(new Set),[R,C]=c.useState(!1),H=25,{data:S,isLoading:K,isError:P,error:Q,refetch:ee,isFetching:J}=Fe({search:o==="history"||t.trim()!==""?"":void 0,reviewStatus:o==="history"?"all":o},d,H),{data:re,isLoading:l,isFetching:$}=We(t.trim(),d,H),{mutateAsync:V,isPending:B}=Re(),F=c.useRef(null),N=o==="history"?{addons:p.map(a=>a.addon),total:p.length,totalPages:Math.ceil(p.length/H)}:t.trim()?re||{addons:[],total:0,totalPages:1}:S||{addons:[],total:0,totalPages:1},L=o==="history"||t.trim()?N.addons:N.addons.filter(a=>!T.has(a.$id)),Y=o==="history"?Math.ceil(p.length/H):N.totalPages,U=t.trim()?l:K,ne=t.trim()?$:J;c.useEffect(()=>{k(1),w(0),o==="history"&&z(new Set)},[t,o]),c.useEffect(()=>{u>=L.length&&L.length>0&&w(0)},[d,L.length,u]);const ce=c.useCallback(a=>{const r={...a,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()};y(s=>[r,...s].slice(0,10))},[]),de=c.useCallback((a,r)=>{const s={id:`${Date.now()}-${Math.random()}`,addon:{...a},action:r,timestamp:Date.now()};E(m=>[s,...m].slice(0,10)),z(m=>new Set([...m,a.$id]))},[]),W=c.useCallback(()=>{E([]),M({title:"âœ¨ History cleared",description:"Review history has been cleared successfully."})},[]),Z=c.useCallback(async()=>{if(f.length===0)return;const a=f[0];try{await V({addonId:a.addonId,data:{[a.field]:a.previousValue}}),y(r=>r.slice(1)),z(r=>{const s=new Set(r);return s.delete(a.addonId),s}),E(r=>r.filter(s=>s.addon.$id!==a.addonId)),M({title:"â†©ï¸ Action undone",description:`Reverted ${a.addonName} to previous state.`}),ee()}catch(r){r?.code===401&&C(!0),M({variant:"destructive",title:"âŒ Undo failed",description:"Could not undo the last action."})}},[f,V,ee]),ae=async(a,r,s=!1)=>{try{if(ce({addonId:a.$id,addonName:a.name,field:"isChecked",previousValue:a.isChecked,newValue:r}),await V({addonId:a.$id,data:{isChecked:r}}),de(a,r?"approved":"rejected"),M({title:r?"âœ… Addon approved":"âš ï¸ Marked for review",description:`${a.name} has been ${r?"approved":"marked for review"}.`}),h&&s){const x=L.filter(n=>n.$id!==a.$id);u>=x.length&&x.length>0&&w(x.length-1)}ee(),C(!1)}catch(m){m?.code===401||m?.message?.includes("not authorized")?(C(!0),M({variant:"destructive",title:"ðŸ”’ Permission denied",description:"You need admin permissions to update addons. Please check your permissions in Appwrite."})):M({variant:"destructive",title:"âŒ Update failed",description:"There was an error updating the review status."})}},i=async(a,r,s=!1)=>{try{ce({addonId:a.$id,addonName:a.name,field:"isValid",previousValue:a.isValid,newValue:r});const m=r?{isValid:r,isChecked:!0}:{isValid:r};await V({addonId:a.$id,data:m}),de(a,r?"enabled":"disabled");let n={title:r?"âœ… Addon activated":"ðŸš« Addon deactivated",description:`${a.name} has been ${r?"approved and enabled":"disabled"}.`};if(r&&!a.isChecked&&(n.description+=" It has also been marked as reviewed."),M(n),h&&s){const A=L.filter(I=>I.$id!==a.$id);u>=A.length&&A.length>0&&w(A.length-1)}ee(),C(!1)}catch(m){m?.code===401||m?.message?.includes("not authorized")?(C(!0),M({variant:"destructive",title:"ðŸ”’ Permission denied",description:"You need admin permissions to update addons. Please check your permissions in Appwrite."})):M({variant:"destructive",title:"âŒ Update failed",description:"There was an error updating the addon status."})}};Ye({onApprove:()=>{const a=L[u];a&&!a.isChecked&&ae(a,!0,!0)},onReject:()=>{const a=L[u];a&&!a.isChecked&&ae(a,!0,!0)},onEnable:()=>{const a=L[u];a&&!a.isValid&&i(a,!0,!0)},onDisable:()=>{const a=L[u];a&&a.isValid&&i(a,!1,!0)},onNext:()=>{w(a=>Math.min(a+1,L.length-1))},onPrevious:()=>{w(a=>Math.max(a-1,0))},onUndo:Z,onExit:()=>b(!1)},h&&L.length>0),c.useEffect(()=>{if(h&&F.current){const a=F.current.querySelector(`[data-addon-index="${u}"]`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})}},[u,h]);const g=[{accessorKey:"icon",header:"Addon",cell:({row:a})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:e.jsxs(me,{className:"h-12 w-12 ring-2 ring-border",children:[e.jsx(he,{src:a.original.icon||"",alt:`${a.original.name} icon`}),e.jsx(xe,{className:"bg-gradient-to-br from-primary/20 to-primary/10",children:a.original.name.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex flex-col",children:[(()=>{let r=null;if(a.original.modrinth_raw)try{const s=typeof a.original.modrinth_raw=="string"?JSON.parse(a.original.modrinth_raw):a.original.modrinth_raw;s?.slug&&(r=`https://modrinth.com/mod/${s.slug}`)}catch(s){console.warn("Failed to parse modrinth_raw data:",s)}if(!r&&a.original.curseforge_raw)try{const s=typeof a.original.curseforge_raw=="string"?JSON.parse(a.original.curseforge_raw):a.original.curseforge_raw;s?.links?.websiteUrl&&(r=s.links.websiteUrl)}catch(s){console.warn("Failed to parse curseforge_raw data:",s)}return r?e.jsx(te,{to:r,target:"_blank",rel:"noopener noreferrer",className:"group",children:e.jsxs("div",{className:"font-medium transition-colors hover:text-primary flex items-center gap-1",children:[a.original.name,e.jsx(Ce,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity"})]})}):e.jsx("div",{className:"font-medium",children:a.original.name})})(),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["by ",a.original.authors?.join(", ")||"Unknown"]})]})]})},{accessorKey:"description",header:"Description",cell:({row:a})=>e.jsx(ts,{children:e.jsxs(is,{children:[e.jsx(rs,{asChild:!0,children:e.jsx("div",{className:"max-w-md truncate text-sm text-muted-foreground cursor-help",children:a.original.description||"No description available"})}),e.jsx(ns,{className:"max-w-sm",children:e.jsx("p",{children:a.original.description||"No description available"})})]})})},...o==="history"?[{accessorKey:"action",header:"Action Taken",cell:({row:a})=>{const r=p.find(n=>n.addon.$id===a.original.$id);if(!r)return null;const m={approved:{color:"bg-green-100 text-green-800 border-green-300 dark:bg-green-900/20 dark:text-green-400",icon:ze},rejected:{color:"bg-yellow-100 text-yellow-800 border-yellow-300 dark:bg-yellow-900/20 dark:text-yellow-400",icon:Pe},enabled:{color:"bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-900/20 dark:text-blue-400",icon:Ue},disabled:{color:"bg-red-100 text-red-800 border-red-300 dark:bg-red-900/20 dark:text-red-400",icon:Te}}[r.action],x=m.icon;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(v,{variant:"outline",className:Ne("w-fit",m.color),children:[e.jsx(x,{className:"mr-1 h-3 w-3"}),r.action.charAt(0).toUpperCase()+r.action.slice(1)]}),e.jsxs("span",{className:"text-muted-foreground text-xs flex items-center gap-1",children:[e.jsx(Be,{className:"h-3 w-3"}),new Date(r.timestamp).toLocaleString()]})]})}}]:[{accessorKey:"status",header:"Status",cell:({row:a,table:r})=>{const s=r.getRowModel().rows.findIndex(x=>x.original.$id===a.original.$id),m=h&&u===s;return e.jsxs("div",{className:Ne("flex flex-col gap-3 rounded-lg p-3 transition-all",m&&"bg-primary/5 ring-2 ring-primary shadow-sm"),"data-addon-index":s,children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{id:`review-${a.original.$id}`,checked:a.original.isChecked,onCheckedChange:x=>ae(a.original,x===!0),disabled:B||a.original.isValid||R,className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsx("label",{htmlFor:`review-${a.original.$id}`,className:Ne("text-sm font-medium",(a.original.isValid||R)&&"text-muted-foreground cursor-not-allowed"),children:"Reviewed"})]}),a.original.isChecked?e.jsxs(v,{variant:"outline",className:"w-fit border-green-500/50 bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400",children:[e.jsx(ze,{className:"mr-1 h-3 w-3"}),"Reviewed"]}):e.jsxs(v,{variant:"outline",className:"w-fit border-yellow-500/50 bg-yellow-50 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400",children:[e.jsx(Pe,{className:"mr-1 h-3 w-3"}),"Needs Review"]})]}),e.jsx(Ae,{className:"my-1"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{id:`valid-${a.original.$id}`,checked:a.original.isValid,onCheckedChange:x=>i(a.original,x),disabled:B||R,className:"data-[state=checked]:bg-primary"}),e.jsx("label",{htmlFor:`valid-${a.original.$id}`,className:Ne("text-sm font-medium",R&&"text-muted-foreground cursor-not-allowed"),children:a.original.isValid?"Enabled":"Disabled"})]}),e.jsx(v,{variant:a.original.isValid?"default":"destructive",className:"w-fit",children:a.original.isValid?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"mr-1 h-3 w-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"mr-1 h-3 w-3"}),"Inactive"]})})]})]})}}],{accessorKey:"downloads",header:"Stats",cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(oe,{size:14}),e.jsx("span",{className:"font-medium",children:a.original.downloads?.toLocaleString()||"0"})]})})}];return P?e.jsx(q,{className:"border-destructive/50",children:e.jsx(le,{className:"flex h-96 items-center justify-center",children:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"rounded-full bg-destructive/10 p-3",children:e.jsx(Ee,{className:"h-8 w-8 text-destructive"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Failed to load addons"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:Q?.message||"Unknown error"})]}),e.jsxs(j,{onClick:()=>ee(),variant:"outline",className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Retry"]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{children:R&&e.jsx(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(be,{variant:"destructive",className:"border-red-500/50",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx(Se,{children:"Permission Error"}),e.jsxs(we,{children:["You don't have permission to update addons. Please ensure:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"You're logged in as an admin user"}),e.jsx("li",{children:"The admin team has write permissions on the addons collection"}),e.jsx("li",{children:"Your session is still valid"})]}),"Contact your Appwrite administrator to grant proper permissions."]})]})})}),e.jsx(q,{children:e.jsx(Ge,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{className:"text-2xl",children:"ðŸŽ¨ Addons Management (V2)"}),e.jsxs(Ze,{children:["Review and manage addon extensions efficiently",S&&S.total>0&&e.jsxs("span",{className:"ml-1",children:["â€¢ Page ",d," of ",Y," â€¢ ",S.total," total addons"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:Z,disabled:B,className:"gap-2",children:[e.jsx(Oe,{size:16}),"Undo (",f.length,")"]}),o==="history"&&p.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:W,className:"gap-2",children:[e.jsx(Je,{size:16}),"Clear History"]}),e.jsxs(j,{variant:h?"default":"outline",size:"sm",onClick:()=>b(!h),className:"gap-2",children:[e.jsx(je,{size:16}),h?"Exit Review Mode":"Review Mode"]})]})]})})}),e.jsx(ie,{children:h&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsxs(be,{className:"border-blue-500/50 bg-blue-50/50 dark:bg-blue-950/20",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(Se,{children:"Review Mode Active"}),e.jsxs(we,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{children:"Use keyboard shortcuts for faster review"}),e.jsxs(v,{variant:"secondary",children:[u+1," of ",L.length]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mt-3",children:[e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"A"})," Approve addon"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"R"})," Reject addon"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"E"})," Enable addon"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"X"})," Disable addon"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"â†‘/â†“"})," Navigate"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded border",children:"Ctrl+Z"})," Undo"]})]}),L.length>0&&e.jsx("p",{className:"text-xs mt-3 text-muted-foreground",children:"ðŸ’¡ Actions automatically advance to the next addon"})]})]})})}),e.jsx(q,{children:e.jsx(le,{className:"pt-6",children:e.jsxs(De,{defaultValue:"unsorted",className:"w-full",onValueChange:a=>_(a),children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(_e,{className:"grid grid-cols-5 w-full sm:w-auto",children:[e.jsxs(G,{value:"unsorted",className:"gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Unsorted",S&&e.jsx(v,{variant:"destructive",className:"ml-1",children:S.addons.filter(a=>!a.isValid&&!T.has(a.$id)).length})]}),e.jsx(G,{value:"all",children:"All Active"}),e.jsxs(G,{value:"unreviewed",className:"gap-2",children:["Needs Review",S&&e.jsx(v,{variant:"secondary",className:"ml-1",children:S.addons.filter(a=>!a.isChecked&&!T.has(a.$id)).length})]}),e.jsx(G,{value:"reviewed",children:"Reviewed"}),e.jsxs(G,{value:"history",className:"gap-2",children:["History",e.jsx(v,{variant:"outline",className:"ml-1",children:p.length})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Me,{placeholder:o==="history"?"Search history...":"Search all addons...",value:t,onChange:a=>D(a.target.value),className:"w-[300px] pl-10",disabled:o==="history"})]})]}),e.jsx(fe,{value:o,className:"mt-6",children:e.jsx(ie,{mode:"wait",children:e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx("div",{ref:F,className:"rounded-lg border overflow-hidden",children:U||ne?e.jsx("div",{className:"flex h-64 items-center justify-center bg-muted/5",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.trim()?"Searching addons...":"Loading addons..."})]})}):e.jsx(ue,{columns:g,data:o==="history"?p.slice((d-1)*H,d*H).map(a=>a.addon):L})}),Y>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",L.length," of"," ",o==="history"?p.length:N.total," ","addons",o==="history"&&" (from recent actions)",t.trim()&&" (search results)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(a=>Math.max(a-1,1)),disabled:d===1||J,children:[e.jsx(He,{size:16}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Y)},(a,r)=>{let s;if(Y<=5)s=r+1;else{const m=Math.max(1,d-2),x=Math.min(Y,m+4);s=Math.max(1,x-4)+r}return e.jsx(j,{variant:d===s?"default":"outline",size:"sm",onClick:()=>k(s),disabled:J,className:"w-10",children:s},s)})}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(a=>Math.min(a+1,Y)),disabled:d===Y||J,children:["Next",e.jsx(Ke,{size:16})]})]})]})]},`${d}-${o}-${t}`)})})]})})}),!U&&!ne&&L.length===0&&e.jsx(q,{className:"border-dashed",children:e.jsx(le,{className:"flex h-40 items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-3",children:e.jsx(Ie,{size:24,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o==="history"?"No review history yet":t.trim()?"No addons found":"No addons to display"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:o==="history"?"Actions taken on addons will appear here":t.trim()?"Try adjusting your search terms":o==="unreviewed"?"All addons have been reviewed!":"Try adjusting your filter criteria"})]})]})})})]})},Qe=()=>{const[d,k]=c.useState(1),[t,D]=c.useState(""),[o,_]=c.useState("unsorted"),[h,b]=c.useState(!1),[u,w]=c.useState(!1),[f,y]=c.useState(0),[p,E]=c.useState([]),[T,z]=c.useState(new Set),[R,C]=c.useState(!1),H=25,S=c.useRef(null),{data:K,isLoading:P,isError:Q,error:ee,refetch:J,isFetching:re}=Fe({reviewStatus:o},d,H),{data:l,isLoading:$,isFetching:V}=ms({query:t.trim(),page:1,limit:H}),{mutateAsync:B,isPending:F}=Re(),ve=c.useMemo(()=>t.trim()?l||[]:K?.addons||[],[t,l,K]),N=c.useMemo(()=>t.trim()?ve:ve.filter(r=>!T.has(r.$id)),[t,ve,T]),X=K?.totalPages||1,L=t.trim()?$:P,Y=t.trim()?V:re,U=c.useMemo(()=>N.filter(r=>!r.isChecked||!r.isValid),[N]);c.useEffect(()=>{k(1),y(0),o!=="unsorted"&&z(new Set)},[t,o]),c.useEffect(()=>{const r=h?U:N;f>=r.length&&r.length>0&&y(Math.max(0,r.length-1))},[f,U,N,h]);const ne=c.useCallback(r=>{const s={...r,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()};E(m=>[s,...m].slice(0,10))},[]),ce=c.useCallback((r,s)=>{z(m=>new Set([...m,r.$id]))},[]),de=c.useCallback(async()=>{if(p.length===0)return;const r=p[0];try{await B({addonId:r.addonId,data:{[r.field]:r.previousValue}}),E(s=>s.slice(1)),z(s=>{const m=new Set(s);return m.delete(r.addonId),m}),M({title:"â†©ï¸ Action undone",description:`Reverted ${r.addonName} to previous state.`}),J(),C(!1)}catch(s){s?.code===401&&C(!0),M({variant:"destructive",title:"âŒ Undo failed",description:"Could not undo the last action."})}},[p,B,J]),W=async(r,s,m=!1)=>{try{if(ne({addonId:r.$id,addonName:r.name,field:"isChecked",previousValue:r.isChecked,newValue:s}),await B({addonId:r.$id,data:{isChecked:s}}),ce(r,s?"approved":"rejected"),M({title:s?"âœ… Addon approved":"âš ï¸ Marked for review",description:`${r.name} has been ${s?"approved":"marked for review"}.`}),m&&(h||u)){const n=h?U:N,A=n.findIndex(se=>se.$id===r.$id),I=A<n.length-1?A:Math.max(0,A-1);y(I)}J(),C(!1)}catch(x){x?.code===401||x?.message?.includes("not authorized")?(C(!0),M({variant:"destructive",title:"ðŸ”’ Permission denied",description:"You need admin permissions to update addons."})):M({variant:"destructive",title:"âŒ Update failed",description:"There was an error updating the review status."})}},Z=async(r,s,m=!1)=>{try{ne({addonId:r.$id,addonName:r.name,field:"isValid",previousValue:r.isValid,newValue:s});const x=s?{isValid:s,isChecked:!0}:{isValid:s};if(await B({addonId:r.$id,data:x}),ce(r,s?"enabled":"disabled"),M({title:s?"âœ… Addon activated":"ðŸš« Addon deactivated",description:`${r.name} has been ${s?"approved and enabled":"disabled"}.`}),m&&(h||u)){const A=h?U:N,I=A.findIndex(ss=>ss.$id===r.$id),se=I<A.length-1?I:Math.max(0,I-1);y(se)}J(),C(!1)}catch(x){x?.code===401||x?.message?.includes("not authorized")?(C(!0),M({variant:"destructive",title:"ðŸ”’ Permission denied",description:"You need admin permissions to update addons."})):M({variant:"destructive",title:"âŒ Update failed",description:"There was an error updating the addon status."})}},ae=c.useCallback(r=>{const s=h?U:N;y(r==="next"?m=>Math.min(m+1,s.length-1):m=>Math.max(m-1,0))},[h,U,N]);Ye({onApprove:()=>{const s=(h?U:N)[f];s&&!s.isChecked&&W(s,!0,!0)},onReject:()=>{const s=(h?U:N)[f];s&&W(s,!1,!0)},onEnable:()=>{const s=(h?U:N)[f];s&&!s.isValid&&Z(s,!0,!0)},onDisable:()=>{const s=(h?U:N)[f];s&&s.isValid&&Z(s,!1,!0)},onNext:()=>ae("next"),onPrevious:()=>ae("prev"),onUndo:de,onExit:()=>{b(!1),w(!1)}},(h||u)&&(h?U.length>0:N.length>0)),c.useEffect(()=>{if((h||u)&&S.current&&!u){const r=S.current.querySelector(`[data-addon-index="${f}"]`);r&&r.scrollIntoView({behavior:"smooth",block:"center"})}},[f,h,u]);const i=()=>{const r=h?U:N,s=r[f];if(!s)return null;const x=(n=>{try{if(n.modrinth_raw){const A=typeof n.modrinth_raw=="string"?JSON.parse(n.modrinth_raw):n.modrinth_raw;if(A?.slug)return`https://modrinth.com/mod/${A.slug}`}if(n.curseforge_raw){const A=typeof n.curseforge_raw=="string"?JSON.parse(n.curseforge_raw):n.curseforge_raw;if(A?.links?.websiteUrl)return A.links.websiteUrl}}catch(A){console.warn("Failed to parse addon URLs:",A)}return null})(s);return e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-background flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>w(!1),children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Exit Fullscreen"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(me,{className:"h-8 w-8",children:[e.jsx(he,{src:s.icon||""}),e.jsx(xe,{children:s.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.authors?.join(", ")||"Unknown"})]})]}),e.jsx(v,{variant:s.isValid?"default":"destructive",children:s.isValid?"Active":"Inactive"}),e.jsx(v,{variant:s.isChecked?"default":"secondary",children:s.isChecked?"Reviewed":"Needs Review"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[f+1," of ",r.length]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>ae("prev"),disabled:f===0,children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>ae("next"),disabled:f===r.length-1,children:e.jsx(ds,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("div",{className:"w-96 border-r bg-card p-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Addon Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description||"No description available"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(Array.isArray(s.categories)?s.categories:[]).map(n=>e.jsx(v,{variant:"outline",className:"text-xs",children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Downloads"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),s.downloads?.toLocaleString()||"0"]})]})]})]}),e.jsx(Ae,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Review Actions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{checked:s.isChecked,onCheckedChange:n=>W(s,n===!0,!0),disabled:F||R}),e.jsx("label",{className:"text-sm font-medium",children:"Mark as Reviewed"})]})}),e.jsx(Ae,{}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{checked:s.isValid,onCheckedChange:n=>Z(s,n,!0),disabled:F||R}),e.jsx("label",{className:"text-sm font-medium",children:s.isValid?"Enabled":"Disabled"})]})}),e.jsx(Ae,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(j,{size:"sm",onClick:()=>W(s,!0,!0),disabled:s.isChecked||F||R,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>Z(s,!0,!0),disabled:s.isValid||F||R,children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Enable"]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>Z(s,!1,!0),disabled:!s.isValid||F||R,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Disable"]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>W(s,!1,!0),disabled:F||R,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"Needs Work"]})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-muted/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Addon Details"})]}),x&&e.jsx(j,{size:"sm",variant:"default",asChild:!0,children:e.jsxs(te,{to:x,target:"_blank",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"View on ",x.includes("modrinth")?"Modrinth":"CurseForge"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-2xl space-y-6",children:[(()=>{let n=null,A=null;try{s.modrinth_raw?(n=typeof s.modrinth_raw=="string"?JSON.parse(s.modrinth_raw):s.modrinth_raw,A="Modrinth"):s.curseforge_raw&&(n=typeof s.curseforge_raw=="string"?JSON.parse(s.curseforge_raw):s.curseforge_raw,A="CurseForge")}catch(I){console.warn("Failed to parse raw addon data:",I)}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Description"}),A&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["From ",A]})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:n?.description||s.description||"No description available for this addon."})]}),n?.gallery&&n.gallery.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Screenshots"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.gallery.slice(0,4).map((I,se)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:typeof I=="string"?I:I.url||"",alt:typeof I=="string"?`Screenshot ${se+1}`:I.title||`Screenshot ${se+1}`,className:"w-full h-32 object-cover rounded-md border hover:scale-105 transition-transform cursor-pointer"}),typeof I!="string"&&I.title&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 text-white text-xs p-2 rounded-b-md opacity-0 group-hover:opacity-100 transition-opacity",children:typeof I!="string"?I.title:""})]},se)),n.gallery.length>4&&e.jsx("div",{className:"flex items-center justify-center h-32 bg-muted rounded-md border border-dashed",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["+",n.gallery.length-4," more images"]})})]})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Project Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.license&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"License"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.license.name||n.license.id||n.license})]}),n.project_type&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Project Type"}),e.jsx(v,{variant:"secondary",className:"mt-1",children:n.project_type})]}),n.status&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsx(v,{variant:n.status==="approved"?"default":"secondary",className:"mt-1",children:n.status})]}),(n.client_side||n.server_side)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Compatibility"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[n.client_side&&e.jsxs(v,{variant:"outline",children:["Client: ",n.client_side]}),n.server_side&&e.jsxs(v,{variant:"outline",children:["Server: ",n.server_side]})]})]})]}),n.team&&n.team.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Team Members"}),e.jsx("div",{className:"space-y-2",children:n.team.map((I,se)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[I.user?.avatar_url&&e.jsx("img",{src:I.user.avatar_url,alt:I.user.username,className:"w-6 h-6 rounded-full"}),e.jsx("span",{className:"font-medium",children:I.user?.username||I.name}),e.jsx(v,{variant:"outline",className:"text-xs",children:I.role})]},se))})]}),n.donation_urls&&n.donation_urls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Support the Developer"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.donation_urls.map((I,se)=>e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(te,{to:I.url,target:"_blank",children:I.platform||"Donate"})},se))})]}),(n.issues_url||n.source_url||n.wiki_url||n.discord_url)&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"External Links"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.issues_url&&e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(te,{to:n.issues_url,target:"_blank",children:"ðŸ› Issues"})}),n.source_url&&e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(te,{to:n.source_url,target:"_blank",children:"ðŸ’» Source Code"})}),n.wiki_url&&e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(te,{to:n.wiki_url,target:"_blank",children:"ðŸ“– Wiki"})}),n.discord_url&&e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(te,{to:n.discord_url,target:"_blank",children:"ðŸ’¬ Discord"})})]})]})]})]})})(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.categories&&s.categories.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(Array.isArray(s.categories)?s.categories:[]).map(n=>e.jsx(v,{variant:"secondary",children:n.replace(/[-_]/g," ").replace(/\b\w/g,A=>A.toUpperCase())},n))})]}),s.minecraft_versions&&s.minecraft_versions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Minecraft Versions"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(Array.isArray(s.minecraft_versions)?s.minecraft_versions:[]).slice(0,8).map(n=>e.jsx(v,{variant:"outline",className:"text-xs",children:n},n)),s.minecraft_versions.length>8&&e.jsxs(v,{variant:"outline",className:"text-xs",children:["+",s.minecraft_versions.length-8," more"]})]})]}),s.loaders&&s.loaders.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Mod Loaders"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(Array.isArray(s.loaders)?s.loaders:[]).map(n=>e.jsx(v,{variant:"secondary",children:n},n))})]}),s.create_versions&&s.create_versions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Create Mod Versions"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.create_versions.map(n=>e.jsx(v,{variant:"outline",className:"text-xs",children:n},n))})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.downloads?.toLocaleString()||"0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Downloads"})]})]})}),e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Created"})]})]})}),e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.updated_at?new Date(s.updated_at).toLocaleDateString():"Unknown"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Updated"})]})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Data Sources"}),e.jsxs("div",{className:"grid gap-2",children:[s.modrinth_id&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{variant:"outline",children:"Modrinth"}),e.jsx("span",{className:"font-mono text-xs",children:s.modrinth_id})]}),s.curseforge_id&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{variant:"outline",children:"CurseForge"}),e.jsx("span",{className:"font-mono text-xs",children:s.curseforge_id})]})]})]}),s.claimed_by&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Claim Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"secondary",children:"Claimed"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["by ",s.claimed_by]})]})]}),x&&e.jsx(q,{className:"p-4 bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"View Full Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Open this addon's page in a new tab to see all details, images, and versions."})]}),e.jsx(j,{asChild:!0,children:e.jsxs(te,{to:x,target:"_blank",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Open Page"]})})]})})]})})]})]}),e.jsx("div",{className:"p-4 border-t bg-card",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded",children:"A"})," Approve"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded",children:"E"})," Enable"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded",children:"X"})," Disable"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-background rounded",children:"â†/â†’"})," Navigate"]})]})})})]})},g=()=>{const r=[{key:"unsorted",label:"Needs Review",count:K?.addons?.filter(s=>!s.isValid).length},{key:"unreviewed",label:"Unreviewed",count:K?.addons?.filter(s=>!s.isChecked).length},{key:"reviewed",label:"Reviewed"},{key:"all",label:"All Active"}];return e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(({key:s,label:m,count:x})=>e.jsxs(j,{variant:o===s?"default":"outline",size:"sm",onClick:()=>_(s),className:"gap-2",children:[m,x!==void 0&&x>0&&e.jsx(v,{variant:s==="unsorted"?"destructive":"secondary",className:"ml-1",children:x})]},s))})},a=[{accessorKey:"icon",header:"Addon",cell:({row:r})=>{const s=r.original;let m=null;try{if(s.modrinth_raw){const x=typeof s.modrinth_raw=="string"?JSON.parse(s.modrinth_raw):s.modrinth_raw;x?.slug&&(m=`https://modrinth.com/mod/${x.slug}`)}if(!m&&s.curseforge_raw){const x=typeof s.curseforge_raw=="string"?JSON.parse(s.curseforge_raw):s.curseforge_raw;x?.links?.websiteUrl&&(m=x.links.websiteUrl)}}catch(x){console.warn("URL parsing failed:",x)}return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(he,{src:s.icon||""}),e.jsx(xe,{children:s.name.charAt(0)})]}),e.jsxs("div",{children:[m?e.jsxs(te,{to:m,target:"_blank",className:"font-medium hover:text-primary flex items-center gap-1",children:[s.name,e.jsx(Ce,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.authors?.join(", ")||"Unknown"})]})]})}},{accessorKey:"description",header:"Description",cell:({row:r})=>e.jsx("div",{className:"max-w-md truncate text-sm",children:r.original.description||"No description"})},{accessorKey:"status",header:"Status",cell:({row:r,table:s})=>{const m=r.original,x=s.getRowModel().rows.findIndex(A=>A.original.$id===m.$id),n=h&&f===x;return e.jsxs("div",{className:Ne("flex items-center gap-4 p-2 rounded",n&&"bg-primary/10 ring-1 ring-primary"),"data-addon-index":x,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{checked:m.isChecked,onCheckedChange:A=>W(m,A===!0),disabled:F||R}),e.jsx(v,{variant:m.isChecked?"default":"secondary",children:m.isChecked?"Reviewed":"Needs Review"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{checked:m.isValid,onCheckedChange:A=>Z(m,A),disabled:F||R}),e.jsx(v,{variant:m.isValid?"default":"destructive",children:m.isValid?"Active":"Inactive"})]})]})}},{accessorKey:"downloads",header:"Downloads",cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(oe,{className:"h-4 w-4"}),r.original.downloads?.toLocaleString()||"0"]})}];return Q?e.jsx(q,{className:"border-destructive/50",children:e.jsx(le,{className:"flex h-96 items-center justify-center",children:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(Ee,{className:"h-12 w-12 text-destructive mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Failed to load addons"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:ee?.message||"Unknown error"})]}),e.jsxs(j,{onClick:()=>J(),variant:"outline",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(ie,{children:R&&e.jsx(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(be,{variant:"destructive",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx(Se,{children:"Permission Error"}),e.jsx(we,{children:"You don't have permission to update addons. Please ensure you're logged in as an admin user."})]})})}),e.jsx(q,{children:e.jsx(Ge,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{className:"text-2xl",children:"ðŸš€ Addons Management (V3)"}),e.jsxs(Ze,{children:["Streamlined addon review and management",K&&K.total>0&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",K.total," total addons"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:de,disabled:F,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Undo (",p.length,")"]}),e.jsxs(j,{variant:h?"default":"outline",size:"sm",onClick:()=>b(!h),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),h?"Exit Review":"Review Mode"]}),h&&U.length>0&&e.jsxs(j,{variant:"secondary",size:"sm",onClick:()=>w(!0),children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Fullscreen Review"]})]})]})})}),e.jsx(ie,{children:h&&!u&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsxs(be,{children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(Se,{children:"Review Mode Active"}),e.jsx(we,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Use keyboard shortcuts for faster review"}),e.jsxs(v,{variant:"secondary",children:[f+1," of ",U.length," needing review"]})]})})]})})}),e.jsx(q,{children:e.jsx(le,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(g,{}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Me,{placeholder:"Search all addons globally...",value:t,onChange:r=>D(r.target.value),className:"w-[400px] pl-10"})]})]})})}),e.jsx(q,{children:e.jsx(le,{className:"p-0",children:e.jsx("div",{ref:S,className:"max-h-[70vh] overflow-auto",children:L||Y?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:t.trim()?"Searching...":"Loading..."})]})}):e.jsx(ue,{columns:a,data:N})})})}),X>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",N.length," of ",K?.total||0," addons",t.trim()&&" (search results)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(r=>Math.max(r-1,1)),disabled:d===1||Y,children:[e.jsx(He,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("span",{className:"text-sm",children:["Page ",d," of ",X]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>k(r=>Math.min(r+1,X)),disabled:d===X||Y,children:["Next",e.jsx(Ke,{className:"h-4 w-4"})]})]})]}),!L&&!Y&&N.length===0&&e.jsx(q,{className:"border-dashed",children:e.jsx(le,{className:"flex h-40 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:t.trim()?"No addons found":"No addons to display"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:t.trim()?"Try different search terms":"All addons have been processed!"})]})})})]}),e.jsx(ie,{children:u&&e.jsx(i,{})})]})},$s=()=>{const d=Ve.c(3);let k;d[0]===Symbol.for("react.memo_cache_sentinel")?(k=e.jsxs(_e,{children:[e.jsx(G,{className:"cursor-pointer",value:"addons",children:"All Addons"}),e.jsx(G,{className:"cursor-pointer",value:"featured",children:"Featured"})]}),d[0]=k):k=d[0];let t;d[1]===Symbol.for("react.memo_cache_sentinel")?(t=e.jsx(fe,{value:"addons",children:e.jsx(Qe,{})}),d[1]=t):t=d[1];let D;return d[2]===Symbol.for("react.memo_cache_sentinel")?(D=e.jsxs(De,{defaultValue:"addons",className:"p-6",children:[k,t,e.jsx(fe,{value:"featured",children:e.jsx(es,{})})]}),d[2]=D):D=d[2],D},es=()=>{const[d,k]=c.useState(1),{data:t,isLoading:D,isError:o,error:_,refetch:h}=xs(!1),{mutateAsync:b}=us(),u=t||[],w=async(y,p)=>{try{await b({id:y.$id,addon:{active:p}}),M({className:"bg-surface-3 border-ring text-foreground",title:`âœ… Addon ${p?"activÃ©":"dÃ©sactivÃ©"} âœ…`}),h()}catch(E){M({className:"bg-surface-3 border-ring text-foreground",title:"âŒ Erreur de mise Ã  jour âŒ"}),console.error("Unexpected error:",E)}},f=[{accessorKey:"image_url",header:"Image",cell:({row:y})=>e.jsxs(me,{children:[e.jsx(he,{src:y.original.image_url||""}),e.jsx(xe,{children:"ADDON"})]})},{accessorKey:"addon_id",header:"Addon ID"},{accessorKey:"title",header:"Title",cell:({row:y})=>e.jsx("span",{className:"font-medium",children:y.original.title})},{accessorKey:"description",header:"Description"},{accessorKey:"active",header:({column:y})=>e.jsxs(j,{variant:"ghost",onClick:()=>y.toggleSorting(y.getIsSorted()==="asc"),children:["Status",e.jsx(ls,{className:"ml-2 h-4 w-4"})]}),cell:({row:y})=>e.jsx(ge,{checked:y.original.active,onCheckedChange:p=>w(y.original,p)})}];return D?e.jsx("div",{children:"Chargement..."}):o?e.jsxs("div",{children:["Erreur: ",_?.message]}):e.jsxs("div",{children:[e.jsx("div",{className:"float-end",children:e.jsxs(j,{variant:"success",className:"cursor-pointer",children:[e.jsx(gs,{})," ADD ADDON"]})}),e.jsxs("div",{className:"px-4 md:px-8",children:[e.jsx(ue,{columns:f,data:u}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(j,{onClick:()=>k(y=>Math.max(y-1,1)),children:"PrÃ©cÃ©dent"}),e.jsxs("span",{children:["Page ",d]}),e.jsx(j,{onClick:()=>k(y=>y+1),children:"Suivant"})]})]})]})},Gs={AddAddon:ks,AddonsTable:As,OptimizedAddonsTable:Cs,OptimizedAddonsTableV2:Ss,OptimizedAddonsTableV3:Qe,AdminAddonsMain:$s,FeaturedAddonsTable:es};export{ks as AddAddon,As as AddonsTable,$s as AdminAddonsMain,es as FeaturedAddonsTable,Cs as OptimizedAddonsTable,Ss as OptimizedAddonsTableV2,Qe as OptimizedAddonsTableV3,Gs as default};
