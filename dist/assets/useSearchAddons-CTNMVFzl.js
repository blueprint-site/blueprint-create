import{c as k,s as L}from"./index-CV_NrdTx.js";import{d as M}from"./tanstack-aN5NUOUd.js";import{r as j}from"./radix-x8H_F-uE.js";function V(x){const r={...x};if(typeof r.curseforge_raw=="string")try{r.curseforge_raw_parsed=JSON.parse(r.curseforge_raw)}catch(n){console.error("Failed to parse curseforge_raw JSON",n),r.curseforge_raw_parsed=null}if(typeof r.modrinth_raw=="string")try{if(r.modrinth_raw.length===256)return console.warn("Skipping modrinth_raw parsing - appears to be truncated at 256 characters"),r.modrinth_raw_parsed=null,r;if(r.modrinth_raw.length>0&&!r.modrinth_raw.trim().endsWith("}")&&!r.modrinth_raw.trim().endsWith("]"))return console.warn("Modrinth JSON appears to be truncated:",{length:r.modrinth_raw.length,ending:r.modrinth_raw.slice(-20)}),r.modrinth_raw_parsed=null,r;r.modrinth_raw_parsed=JSON.parse(r.modrinth_raw)}catch(n){console.error("Failed to parse modrinth_raw JSON in search:",{error:n,errorMessage:n instanceof Error?n.message:"Unknown error",jsonLength:r.modrinth_raw.length,jsonStart:r.modrinth_raw.substring(0,100),jsonEnd:r.modrinth_raw.substring(r.modrinth_raw.length-100)}),r.modrinth_raw_parsed=null}return r}const I=x=>{const r=k.c(36),{query:n,page:e,category:i,version:a,loaders:d,limit:O}=x,t=O===void 0?16:O,l=n||"*";let p;r[0]!==i||r[1]!==d||r[2]!==a?(p=()=>{const o=[],m=($,f)=>{if(f&&f!=="all"&&f!=="All"){const P=f.includes(" ")?`"${f}"`:f;o.push(`${$} = ${P}`)}};return m("loaders",d),m("categories",i),m("minecraft_versions",a),o.push("isValid = true"),o.length>0?o.join(" AND "):""},r[0]=i,r[1]=d,r[2]=a,r[3]=p):p=r[3];const N=p;let c;r[4]!==i||r[5]!==t||r[6]!==d||r[7]!==e||r[8]!==l||r[9]!==a?(c=["searchAddons",l,e,i,a,d,t],r[4]=i,r[5]=t,r[6]=d,r[7]=e,r[8]=l,r[9]=a,r[10]=c):c=r[10];let h;r[11]!==N||r[12]!==t||r[13]!==e||r[14]!==l?(h=async()=>{const m=await L.index("addons").search(l,{limit:t,offset:(e-1)*t,filter:N()});return{hits:m.hits,totalHits:m.estimatedTotalHits??0}},r[11]=N,r[12]=t,r[13]=e,r[14]=l,r[15]=h):h=r[15];let u;r[16]!==c||r[17]!==h?(u={queryKey:c,queryFn:h},r[16]=c,r[17]=h,r[18]=u):u=r[18];const{data:s,isLoading:S,isError:H,error:A,isFetching:E}=M(u),[F,q]=j.useState(!1);let g,_;r[19]!==s||r[20]!==t||r[21]!==e?(g=()=>{if(s){const o=(e-1)*t+(s.hits?.length||0)<(s.totalHits||0);q(o)}},_=[s,e,t],r[19]=s,r[20]=t,r[21]=e,r[22]=g,r[23]=_):(g=r[22],_=r[23]),j.useEffect(g,_);let w;r[24]!==s?.hits?(w=s?.hits?.map(V)||[],r[24]=s?.hits,r[25]=w):w=r[25];const b=w,J=s?.totalHits??0;let y;return r[26]!==A||r[27]!==F||r[28]!==H||r[29]!==E||r[30]!==S||r[31]!==t||r[32]!==e||r[33]!==b||r[34]!==J?(y={data:b,isLoading:S,isError:H,error:A,isFetching:E,hasNextPage:F,totalHits:J,page:e,limit:t},r[26]=A,r[27]=F,r[28]=H,r[29]=E,r[30]=S,r[31]=t,r[32]=e,r[33]=b,r[34]=J,r[35]=y):y=r[35],y};export{I as u};
