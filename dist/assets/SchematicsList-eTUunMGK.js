import{r as f,j as d}from"./radix-C-pgD6KV.js";import{c as ie,h as ae,i as ne,j as le,g as oe,k as re,S as ce,l as me,L as he,U as fe,I as de}from"./index-B9yludtD.js";import{L as ue}from"./ListPageLayout-BC5-06Ai.js";import"./tanstack-DgeIbdmq.js";import"./animation-BayOgkCF.js";function Le(){const e=ie.c(56),u=ae(),[i,R]=f.useState(1);let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[0]=p):p=e[0];const[_,S]=f.useState(p),[s,te]=f.useState(""),{filters:t,facets:q,filterString:D,hasActiveFilters:U,updateFilter:l,applyPreset:Q,clearFilters:o}=ne();let x,y;e[1]!==s||e[2]!==l?(x=()=>{l("query",s)},y=[s,l],e[1]=s,e[2]=l,e[3]=x,e[4]=y):(x=e[3],y=e[4]),f.useEffect(x,y);let r;e[5]!==t||e[6]!==s?(r={...t,query:s},e[5]=t,e[6]=s,e[7]=r):r=e[7];let F;e[8]!==i||e[9]!==r?(F={filters:r,page:i,limit:16,enableFacets:!0},e[8]=i,e[9]=r,e[10]=F):F=e[10];const{data:g,isLoading:T,isError:V}=le(F);let X,C;e[11]!==g?.hits?(C=g?.hits||[],e[11]=g?.hits,e[12]=C):C=e[12],X=C;const a=X,c=g?i*16<g.estimatedTotalHits:!1,b=T,G=T||b;let m;e[13]!==c||e[14]!==b||e[15]!==i?(m=()=>{c&&!b&&(console.log("Loading more schematics. Current page:",i),R(Se))},e[13]=c,e[14]=b,e[15]=i,e[16]=m):m=e[16];let L;e[17]!==c||e[18]!==G||e[19]!==m?(L={loading:G,hasMore:c,onLoadMore:m},e[17]=c,e[18]=G,e[19]=m,e[20]=L):L=e[20];const{sentinelRef:H,loadingMore:O}=oe(L);let j;e[21]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{S([]),R(1)},e[21]=j):j=e[21];let E;e[22]!==D||e[23]!==t.sort||e[24]!==s?(E=[D,s,t.sort],e[22]=D,e[23]=t.sort,e[24]=s,e[25]=E):E=e[25],f.useEffect(j,E);let $,I;e[26]!==a||e[27]!==i?($=()=>{a&&a.length>0&&(console.log(`New hits fetched: ${a.length} items`),S(i===1?a:n=>{const N=new Set(n.map(pe)),Z=a.filter(ee=>!N.has(ee.$id||ee.id));return Z.length>0?[...n,...Z]:n}))},I=[a,i],e[26]=a,e[27]=i,e[28]=$,e[29]=I):($=e[28],I=e[29]),f.useEffect($,I);let P;e[30]!==o?(P=()=>{o(),R(1),S([])},e[30]=o,e[31]=P):P=e[31];const z=P;let k;e[32]!==u?(k=n=>{const N=n.$id||n.id;return d.jsx(ce,{schematic:n,onClick:()=>u(`../schematics/${N}/${n.slug}`)},N)},e[32]=u,e[33]=k):k=e[33];const B=k,Y=[t.categories.length,t.subcategories.length,t.materials.primary.length,t.complexity.levels.length,t.compatibility.requiredMods.length,t.dimensions.width.min||t.dimensions.width.max?1:0,t.dimensions.height.min||t.dimensions.height.max?1:0,t.dimensions.blockCount.min||t.dimensions.blockCount.max?1:0].reduce(ge,0);let v;e[34]!==Q||e[35]!==o||e[36]!==q||e[37]!==t||e[38]!==l?(v=d.jsx(me,{filters:t,facets:q,onFilterChange:l,onClearFilters:o,onApplyPreset:Q}),e[34]=Q,e[35]=o,e[36]=q,e[37]=t,e[38]=l,e[39]=v):v=e[39];const J=v;let w;e[40]===Symbol.for("react.memo_cache_sentinel")?(w=re({variant:"default"}),e[40]=w):w=e[40];let A;e[41]===Symbol.for("react.memo_cache_sentinel")?(A=d.jsxs(he,{className:w,to:"../schematics/upload",children:[d.jsx(fe,{className:"mr-2 h-4 w-4"})," Upload Schematic"]}),e[41]=A):A=e[41];const se=A,K=`Schematic Filters${Y>0?` (${Y})`:""}`,W=T&&i===1;let h;e[42]!==_||e[43]!==V||e[44]!==O||e[45]!==B||e[46]!==H||e[47]!==W?(h=d.jsx(de,{items:_,renderItem:B,isLoading:W,isError:V,emptyMessage:"No schematics found matching your filters.",errorMessage:"Oops! Failed to load schematics.",infiniteScrollEnabled:!0,loadingMore:O,sentinelRef:H,animationEnabled:!0,animationDelay:.1,animationDuration:.4,staggerItemCount:16,skeletonCount:16}),e[42]=_,e[43]=V,e[44]=O,e[45]=B,e[46]=H,e[47]=W,e[48]=h):h=e[48];let M;return e[49]!==J||e[50]!==z||e[51]!==U||e[52]!==s||e[53]!==K||e[54]!==h?(M=d.jsx(ue,{searchValue:s,onSearchChange:te,searchPlaceholder:"Search schematics...",filters:J,onResetFilters:z,filterTitle:K,hasActiveFilters:U,headerContent:se,children:h}),e[49]=J,e[50]=z,e[51]=U,e[52]=s,e[53]=K,e[54]=h,e[55]=M):M=e[55],M}function ge(e,u){return e+u}function pe(e){return e.$id||e.id}function Se(e){return e+1}export{Le as default};
