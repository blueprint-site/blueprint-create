import{r as h,j as s}from"./radix-x8H_F-uE.js";import{f as G,d as O,C as U,a as B,aS as b,I as F,j as E,V as k,Q as L,R as _,T as D,P as $,aL as I,c as M}from"./index-CV_NrdTx.js";import{u as P}from"./useSearchAddons-CTNMVFzl.js";import{b as V,d as Q}from"./useFeaturedAddons-D2txhMuP.js";import{S as T}from"./switch-BCDo1lB0.js";import"./tanstack-aN5NUOUd.js";import"./animation-RShxBXpy.js";function H(w){const e=M.c(22),{imageUrl:t,index:r,isSelected:d,onSelect:i}=w,[o,y]=h.useState(!0);let g;e[0]!==t?(g=t.replace(/_\d+\.webp$/,".webp"),e[0]=t,e[1]=g):g=e[1];const l=g;let c,x;e[2]!==r||e[3]!==l?(c=()=>{fetch(l,{method:"HEAD"}).then(j=>{j.ok?console.log(`[GalleryImageItem - ${r}] Full res exists for: ${l}`):(y(!1),console.log(`[GalleryImageItem - ${r}] Full res check failed for: ${l}`))}).catch(()=>{y(!1),console.log(`[GalleryImageItem - ${r}] Full res check error for: ${l}`)})},x=[l,r],e[2]=r,e[3]=l,e[4]=c,e[5]=x):(c=e[4],x=e[5]),h.useEffect(c,x);let u;e[6]!==t||e[7]!==r||e[8]!==o||e[9]!==i||e[10]!==l?(u=()=>{const j=o?l:t;console.log(`[GalleryImageItem - ${r}] Calling onSelect with: ${j}`),i(j)},e[6]=t,e[7]=r,e[8]=o,e[9]=i,e[10]=l,e[11]=u):u=e[11];const v=`relative aspect-video overflow-hidden rounded-lg border-2 transition-all ${d?"border-primary scale-105 shadow-md":"hover:border-primary/30 border-transparent"}`,S=o?l:t,A=`Modrinth gallery image ${r+1}`;let n;e[12]!==S||e[13]!==A?(n=s.jsx("img",{src:S,alt:A,className:"h-full w-full object-cover",loading:"lazy"}),e[12]=S,e[13]=A,e[14]=n):n=e[14];let m;e[15]!==o?(m=!o&&s.jsx("div",{className:"absolute right-0 bottom-0 left-0 bg-black/50 p-1 text-xs text-white",children:"Lower resolution image"}),e[15]=o,e[16]=m):m=e[16];let f;return e[17]!==u||e[18]!==v||e[19]!==n||e[20]!==m?(f=s.jsxs("button",{onClick:u,className:v,children:[n,m]}),e[17]=u,e[18]=v,e[19]=n,e[20]=m,e[21]=f):f=e[21],f}function ee(){const[w,e]=h.useState(""),[t,r]=h.useState(null),[d,i]=h.useState(""),[o,y]=h.useState(0),[g,l]=h.useState(!0),[c,x]=h.useState("gallery"),{data:u,isLoading:v}=P({query:w,page:1,limit:10}),{data:S}=V(),{mutate:A}=Q(),n=S?.map(a=>a.display_order)||[],m=Array.from({length:21},(a,p)=>p).filter(a=>!n.includes(a)),f=a=>{console.log("Selected addon:",a),console.log("Modrinth raw:",a.modrinth_raw),console.log("Modrinth raw parsed:",a.modrinth_raw_parsed),console.log("Gallery data:",a.modrinth_raw_parsed?.gallery),r(a),i("")},j=a=>{i(a)},R=()=>{if(!t){I({title:"Error",description:"Please select an addon",variant:"destructive"});return}if(!d){I({title:"Error",description:"Please select a banner image",variant:"destructive"});return}const a={addon_id:t.$id,title:t.name,description:t.description,image_url:t.icon,banner_url:d,display_order:o,slug:t.slug,active:g,category:Array.isArray(t.categories)?t.categories:t.categories?[t.categories]:null};A(a,{onSuccess:()=>{I({title:"Success",description:"Featured addon created successfully"}),r(null),i(""),y(0)},onError:p=>{I({title:"Error",description:"Failed to create featured addon "+p.message,variant:"destructive"})}})};return s.jsxs(G,{className:"mx-auto w-full max-w-2xl",children:[s.jsx(O,{children:s.jsx(U,{children:"Auto Add Featured Addon"})}),s.jsxs(B,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(b,{children:"Search Addon"}),s.jsx(F,{placeholder:"Search addons...",value:w,onChange:a=>e(a.target.value)}),v?s.jsx("div",{children:"Loading..."}):s.jsx("div",{className:"grid max-h-60 grid-cols-1 gap-2 overflow-y-auto",children:u?.map(a=>s.jsx(E,{variant:t?.$id===a.$id?"default":"outline",className:"justify-start",onClick:()=>f(a),children:a.name},a.$id))})]}),t&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(b,{children:"Banner Image Source"}),s.jsxs(k,{value:c,onValueChange:a=>x(a),children:[s.jsx(L,{children:s.jsx(_,{placeholder:"Select image source"})}),s.jsxs(D,{children:[s.jsx($,{value:"gallery",children:"Choose from gallery"}),s.jsx($,{value:"url",children:"Use URL"})]})]}),c==="gallery"&&t&&s.jsx("div",{className:"grid grid-cols-3 gap-2",children:(()=>{const p=(typeof t.modrinth_raw_parsed=="string"?JSON.parse(t.modrinth_raw_parsed):t.modrinth_raw_parsed)?.gallery;return p&&p.length>0?p.map((C,N)=>s.jsx(H,{imageUrl:C,index:N,isSelected:d===C.replace(/_\d+\.webp$/,".webp")||d===C,onSelect:j},`mr-${N}`)):s.jsx("div",{className:"text-muted-foreground col-span-3 py-4 text-center",children:"No gallery images available for this addon"})})()}),c==="url"&&s.jsx(F,{placeholder:"Enter banner image URL",value:d,onChange:a=>i(a.target.value)})]}),t&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(b,{children:"Display Order"}),s.jsxs(k,{value:o.toString(),onValueChange:a=>y(parseInt(a)),children:[s.jsx(L,{children:s.jsx(_,{placeholder:"Select display order"})}),s.jsx(D,{children:m.map(a=>s.jsxs($,{value:a.toString(),children:["Position ",a]},a))})]}),s.jsxs("div",{className:"text-muted-foreground text-sm",children:["Used positions: ",n.join(", ")]})]}),t&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(T,{id:"active",checked:g,onCheckedChange:l}),s.jsx(b,{htmlFor:"active",children:"Active"})]}),t&&s.jsx(E,{className:"w-full",onClick:R,disabled:!d||!t,children:"Create Featured Addon"})]})]})}export{ee as default};
